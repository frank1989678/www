<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  	
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>选货单详情-boss</title>
    <meta name="renderer" content="webkit" />
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
  	<link rel="stylesheet" href="assets/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>

<div class="wrapper">
	<div class="content">
		<div class="breadcrumb">
			<ul>
                <li>选货单模块</li>
                <li>选货单列表</li>
    		</ul>
		</div>

		<div class="box fa-form fa-form-info">
			<div class="hd">用户信息</div>
            <div class="item">
                <div class="txt">20161014001</div>
                <div class="val">20161014001</div>
            </div>
            <div class="item">
                <div class="txt">用户姓名：</div>
                <div class="val">王先生</div>
            </div>
            <div class="item">
                <div class="txt">手机号：</div>
                <div class="val">18801285391</div>
            </div>
            <div class="item">
                <div class="txt">地区：</div>
                <div class="val">安徽亳州</div>
            </div>
            <div class="item">
                <div class="txt">申请时间：</div>
                <div class="val">2016-05-18 15:22</div>
            </div>
            <div class="item">
                <div class="txt">状态：</div>
                <div class="val status-1">未受理</div>
			</div>
        </div>


        <div class="box fa-form">
            <div class="hd">采购单详情</div>
            <div class="table">
                <table>
                    <thead>
                        <tr>
                            <th>商品名称</th>
                            <th>产地</th>
                            <th>规格等级</th>
                            <th>数量</th>
                            <th>价格</th>
                            <th>合计</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>茯苓</td>
                            <td>云南</td>
                            <td>2级货，过4号筛，直径0.8cm以内</td>
                            <td>10公斤</td>
                            <td>50元/公斤</td>
                            <td>500元</td>
                        </tr>
                        <tr>
                            <td>茯苓</td>
                            <td>云南</td>
                            <td>2级货，过4号筛，直径0.8cm以内</td>
                            <td>10公斤</td>
                            <td>50元/公斤</td>
                            <td>500元</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="6">
                                <div class="total">合计：<em>800元</em></div>
                            </td>
                        </tr>
                    </tfoot>
                </table>    
            </div>                    
        </div>


		<div class="box fa-form">
			<div class="hd">客户信息</div>
            <form id="myform">
                <div class="item">
                    <div class="txt">个人称呼：</div>
                    <div class="cnt">
                        <input type="text" name="username" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">联系电话：</div>
                    <div class="cnt">
                        <input type="text" name="mobile" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">地区：</div>
                    <div class="cnt">
                        <input type="text" name="region" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">身份类型：</div>
                    <div class="cnt cbxs">
                        <label><input type="radio" name="type" class="cbx">饮片厂</label>
                        <label><input type="radio" name="type" class="cbx">药厂</label>
                        <label><input type="radio" name="type" class="cbx">药材经营公司</label>
                        <label><input type="radio" name="type" class="cbx">个体经营户</label>
                        <label><input type="radio" name="type" class="cbx">合作社</label>
                        <label><input type="radio" name="type" class="cbx">种植基地</label>
                        <label><input type="radio" name="type" class="cbx">其他</label>
                        <label><input type="radio" name="type" class="cbx">个人经营</label>
                        <label><input type="radio" name="type" class="cbx">采购经理</label>
                        <label><input type="radio" name="type" class="cbx">销售经理</label>
                    </div>
                </div>
                <div class="item">
                    <div class="txt">姓名/单位：</div>
                    <div class="cnt">
                        <input type="text" name="company" class="ipt" placeholder="姓名/单位" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">用户备注：</div>
                    <div class="cnt">
                        <textarea name="" id="" class="ipt ipt-mul"></textarea>
                    </div>
                </div>
                <div class="ft">
                    <button type="submit" class="ubtn ubtn-blue">保存客户信息</button>
                </div>
            </form>
		</div>

        <div class="box fa-form">
            <div class="hd">采购单追踪</div>
            <ol class="trace" id="trace">
                <li class="fore">状态：<em class="status-1">未受理</em></li>
                <li><span>2016年10月12日 12:30</span><span>用户提交采购单</span></li>
            </ol>
            <div class="ft">
                <button type="button" class="ubtn ubtn-blue submit1">同意受理</button>
                <button type="button" class="ubtn ubtn-gray ml submit2">拒绝受理</button>
            </div>
            <form action="" class="hide" id="traceForm">
                <div class="item">
                    <div class="txt">跟踪记录：</div>
                    <div class="cnt">
                        <textarea name="consigneeNote" class="ipt ipt-mul" placeholder="跟踪记录"></textarea>
                    </div>
                    <div class="cnt">
                        <button type="button" class="ubtn ubtn-gray submit3">提交记录</button>
                    </div>
                </div>
                <div class="ft">
                    <button type="button" class="ubtn ubtn-blue submit4">交易完成</button>
                    <button type="button" class="ubtn ubtn-gray ml submit5">交易未完成</button>
                </div>
            </form>
        </div>
	</div>
</div>    

<script src="assets/js/jquery191.js"></script>
<script src="assets/js/common.js"></script>
<script src="assets/js/jquery.autocomplete.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/laydate/laydate.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script>
	var _global = {
		v: {
		},
		fn: {
			init: function() {
                this.userinfo();
                this.submitEvent();
			},
            // 补全信息
            userinfo: function() {
                var self = this,
                    $jgoosList = $('#jgoosList'),
                    idx = $jgoosList.find('.cnt').length;

                // 添加商品
                $('#jaddNewGoods').on('click', function() {
                    $jgoosList.append('<div class="cnt"> \n <div class="ipt-wrap"><input type="text" name="goods' + (++idx) + '" id="goods' + (++idx) + '" class="ipt" autocomplete="off"></div> \n <button type="button" class="ubtn ubtn-red ml">删除</button> \n </div>');
                    self.searchProduct($('#goods' + idx));
                })

                // 删除价格
                $jgoosList.on('click', '.ubtn-red', function(){
                    $(this).prev().find('.ipt').autocomplete('dispose');
                    $(this).parent().remove();
                })

                self.searchProduct($('#goods1'));

            },
			// 查询品种
			searchProduct: function($ele) {
				$ele.autocomplete({
                    serviceUrl: 'json/catName.json',
                    paramName: 'name',
                    deferRequestBy: 100,
                    showNoSuggestionNotice: true,
                    noSuggestionNotice: '没有该品种',
                    transformResult: function (response) {
                        response = JSON.parse(response);
                        if (response.status == "y") {
                            return {
                                suggestions: $.map(response.data, function (dataItem) {
                                    return {value: dataItem.name, data: dataItem.id};
                                })
                            };
                        } else {
                            return {
                                suggestions: []
                            }
                        }
                    },
                    onSelect: function (suggestion) {
                    }
                });
			},
            // 提交事件
            submitEvent: function() {
                var self = this,
                    $trace = $('#trace'),
                    $pa = $trace.parent();

                // 同意受理
                $pa.on('click', '.submit1', function() {
                    self.submit1();
                    return false;
                })

                // 拒绝受理
                $pa.on('click', '.submit2', function(){
                    self.submit2();
                    return false;
                })

                // 提交记录
                $pa.on('click', '.submit3', function(){
                    var text = $('#traceForm').find('.ipt').val();
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                date: '2016年10月20日 15:20',
                                operator: 'frank',
                                msg: text
                            }
                            $('#traceForm').find('.ipt').val('');
                            self.addNewRevord(data);
                        }
                    })
                })

                // 交易完成
                $pa.on('click', '.submit4', function() {
                    layer.confirm('寄样完成后不能进行跟踪记录操作，是否确认', {
                        btn: ['确认','取消'] //按钮
                    }, function(index){
                        $('#traceForm').remove();
                        layer.close(index);
                    });
                })
                // 交易未完成
                $pa.on('click', '.submit5', function() {
                    self.submit5();
                    return false;
                })
            },
            // 同意受理
            submit1: function() {
                $.ajax({
                    url: '',
                    // data: {},
                    success: function(data) {
                        data = {
                            operator: 'frank',
                            date: '2016年10月20日 15:20'
                        }
                        $('#trace').append('<li><span>' + data.date + '</span><span>操作人：' + data.operator + '</span><span>同意受理该采购单</span></li>');
                        $('.submit2').parent().remove();
                        $('#traceForm').show();
                    }
                })
            },
            // 拒绝受理
            submit2: function() {
                layer.prompt({
                    moveType: 1,
                    formType: 2,
                    title: '拒绝原因',
                    btn: ['拒绝', '关闭']
                }, function(text, index) {
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                operator: 'frank',
                                date: '2016年10月20日 15:20',
                                msg: text
                            }
                            $('#trace').append('<li><span>' + data.date + '</span><span>操作人：' + data.operator + '</span><span>拒绝受理该采购单</span></li><li><span>拒绝理由：' + data.msg + '</span></li>');
                            $('#trace').nextAll().remove();
                        }
                    })
                    layer.close(index);
                });
            },
            // 交易未完成
            submit5: function() {
                layer.prompt({
                    moveType: 1,
                    formType: 2,
                    title: '取消原因',
                    btn: ['确认', '关闭']
                }, function(text, index) {
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                operator: 'frank',
                                date: '2016年10月20日 15:20',
                                msg: text
                            }
                            $('#trace').append('<li><span>' + data.date + '</span><span>操作人：' + data.operator + '</span><span>交易未完成</span></li><li><span>原因：' + data.msg + '</span></li>');
                            $('#trace').nextAll().remove();
                        }
                    })
                    layer.close(index);
                });
            },
            // 表单
            layerForm: function(modal, title) {                
                layer.open({
                    area: ['600px'],
                    type: 1,
                    moveType: 1,
                    content: modal,
                    title: title
                });
            },
            // 添加记录
            addNewRevord: function(data) {
                var html = [];
                $.each(data, function(i, item) {
                    html.push('<span>' + item + '</span>');
                })
                html.length > 1 && $('#trace').append('<li>' + html.join('') + '</li>');
            } 
		}
	}

	$(function() {
		_global.fn.init();
	})
</script>
</body>
</html>