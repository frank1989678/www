<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  	
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>编辑商品-boss</title>
    <meta name="renderer" content="webkit" />
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
  	<link rel="stylesheet" href="assets/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>

<div class="wrapper">
	<div class="content">
		<div class="breadcrumb">
			<ul>
                <li>寄样服务</li>
                <li>寄样详情</li>
    		</ul>
		</div>

		<div class="box fa-form fa-form-info">
			<div class="hd">寄样信息</div>
			<div class="item">
				<div class="txt">用户姓名：</div>
				<div class="val">王先生</div>
			</div>
            <div class="item">
                <div class="txt">寄样单编号：</div>
                <div class="val">20161014001</div>
            </div>
            <div class="item">
                <div class="txt">手机号：</div>
                <div class="val">18801285391</div>
            </div>
            <div class="item">
                <div class="txt">地区：</div>
                <div class="val">安徽亳州</div>
            </div>
            <div class="item">
                <div class="txt">申请时间：</div>
                <div class="val">2016-05-18 15:22</div>
            </div>
            <div class="item">
                <div class="txt">申请商品：</div>
                <div class="val">白芍  安徽亳州   过6-8号筛</div>
            </div>
            <div class="item">
                <div class="txt">状态：</div>
                <div class="val status-1">未受理</div>
            </div>
			<div class="item">
				<div class="txt">历史寄样信息：</div>
                <div class="cnt cnt-table">
                    <div class="table">
                    <table>
                        <thead>
                            <tr>
                                <th>申请商品</th>
                                <th>申请时间</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="#">白芍  安徽亳州   过6-8号筛</a></td>
                                <td>2016-05-18 15:22</td>
                                <td><span class="status-1">未受理</span></td>
                            </tr>
                            <tr>
                                <td><a href="#">白芍  安徽亳州   过6-8号筛</a></td>
                                <td>2016-05-18 15:22</td>
                                <td><span class="status-2">同意寄样</span></td>
                            </tr>
                            <tr>
                                <td><a href="#">白芍  安徽亳州   过6-8号筛</a></td>
                                <td>2016-05-18 15:22</td>
                                <td><span class="status-3">拒绝寄样</span></td>
                            </tr>
                        </tbody>
                    </table>   </div>                     
                </div>
			</div>
        </div>

		<div class="box fa-form">
			<div class="hd">信息补全</div>
            <form id="myform">
                <div class="item">
                    <div class="txt">个人称呼：</div>
                    <div class="cnt">
                        <input type="text" name="username" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">联系电话：</div>
                    <div class="cnt">
                        <input type="text" name="mobile" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">经营类型：</div>
                    <div class="cnt cbxs">
                        <label><input type="radio" name="type" class="cbx">饮片厂</label>
                        <label><input type="radio" name="type" class="cbx">药厂</label>
                        <label><input type="radio" name="type" class="cbx">药材经营公司</label>
                        <label><input type="radio" name="type" class="cbx">个体经营户</label>
                        <label><input type="radio" name="type" class="cbx">合作社</label>
                        <label><input type="radio" name="type" class="cbx">种植基地</label>
                        <label><input type="radio" name="type" class="cbx">其他</label>
                        <label><input type="radio" name="type" class="cbx">个人经营</label>
                        <label><input type="radio" name="type" class="cbx">采购经理</label>
                        <label><input type="radio" name="type" class="cbx">销售经理</label>
                    </div>
                </div>
                <div class="item">
                    <div class="txt">姓名/单位：</div>
                    <div class="cnt">
                        <input type="text" name="company" class="ipt" placeholder="姓名/单位" autocomplete="off">
                    </div>
                </div>
                <div class="item" id="jgoosList">
                    <div class="txt">寄样商品：</div>
                    <div class="cnt">
                        <div class="ipt-wrap">
                            <input type="text" name="goods1" id="goods1" class="ipt" placeholder="" autocomplete="off">
                        </div>
                        <button type="button" class="ubtn ubtn-blue ml" id="jaddNewGoods">添加一行</button>
                    </div>
                </div>
                <div class="item">
                    <div class="txt">用户备注：</div>
                    <div class="cnt">
                        <textarea name="" id="" class="ipt ipt-mul"></textarea>
                    </div>
                </div>
                <div class="ft">
                    <button type="submit" class="ubtn ubtn-blue" id="saveUserinfo">保存客户信息</button>
                </div>
            </form>
		</div>

		<div class="box fa-form">
			<div class="hd">地址信息</div>
            <form action="">
                <div class="item">
                    <div class="txt">收货地址：</div>
                    <div class="cnt">
                        <input type="text" name="consigneeAddress" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">收货人：</div>
                    <div class="cnt">
                        <input type="text" name="consignee" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">收货人电话：</div>
                    <div class="cnt">
                        <input type="text" name="consigneeMobile" class="ipt" placeholder="" autocomplete="off">
                    </div>
                </div>
                <div class="item">
                    <div class="txt">备注信息：</div>
                    <div class="cnt">
                        <textarea name="consigneeNote" class="ipt ipt-mul"></textarea>
                    </div>
                </div>
				<div class="ft">
					<button type="submit" class="ubtn ubtn-blue">保存收货信息</button>
				</div>
            </form>
		</div>

        <div class="box fa-form">
            <div class="hd">寄样追踪</div>
            <ol class="trace" id="trace">
                <li class="fore">状态：<em class="status-1">未受理</em></li>
                <li><span>2016年10月12日 12:30</span><span>申请寄样</span></li>
            </ol>
            <div class="ft">
                <button type="button" class="ubtn ubtn-blue submit1">同意寄样</button>
                <button type="button" class="ubtn ubtn-gray ml submit2">拒绝寄样</button>
            </div>
            <div class="ft hide">
                <button type="button" class="ubtn ubtn-blue submit3">寄送样品</button>
                <button type="button" class="ubtn ubtn-gray ml submit4">客户来访查看</button>
            </div>
            <form action="" class="hide" id="traceForm">
                <div class="item">
                    <div class="txt">跟踪记录：</div>
                    <div class="cnt">
                        <textarea name="consigneeNote" class="ipt ipt-mul" placeholder="跟踪记录"></textarea>
                    </div>
                </div>
                <div class="ft">
                    <button type="button" class="ubtn ubtn-blue submit6">寄样完成</button>
                    <button type="button" class="ubtn ubtn-gray ml submit5">提交记录</button>
                </div>
            </form>
        </div>
	</div>
</div>

<!-- 来访人弹出框 -->
<form id="visitorForm" class="hide">
    <div class="fa-form fa-form-layer">
        <div class="item">
            <div class="txt"><i>*</i>来访人：</div>
            <div class="cnt">
                <input type="text" name="visitor" class="ipt" placeholder="" autocomplete="off">
            </div>
        </div>
        <div class="item">
            <div class="txt"><i>*</i>来访人电话：</div>
            <div class="cnt">
                <input type="text" name="visitorMobile" class="ipt" placeholder="" autocomplete="off">
            </div>
        </div>
        <div class="item">
            <div class="txt"><i>*</i>日期选择：</div>
            <div class="cnt">
                <input type="text" name="visitorDate" id="visitorDate" class="ipt" placeholder="" autocomplete="off">
            </div>
        </div>
        <div class="button">
            <button type="submit" class="ubtn ubtn-blue">确认</button>
            <button type="button" class="ubtn ubtn-gray">取消</button>
        </div>
    </div>
</form>

<!-- 寄送样品弹出框 -->
<form id="expressForm" class="hide">
    <div class="fa-form fa-form-layer">
        <div class="item">
            <div class="txt"><i>*</i>快递公司：</div>
            <div class="cnt">
                <input type="text" name="express" class="ipt" placeholder="" autocomplete="off">
            </div>
        </div>
        <div class="item">
            <div class="txt"><i>*</i>快递单号：</div>
            <div class="cnt">
                <input type="text" name="expressNum" class="ipt" placeholder="" autocomplete="off">
            </div>
        </div>
        <div class="button">
            <button type="submit" class="ubtn ubtn-blue">确认</button>
            <button type="button" class="ubtn ubtn-gray">取消</button>
        </div>
    </div>
</form>

<script src="assets/js/jquery191.js"></script>
<script src="assets/js/jquery.autocomplete.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/laydate/laydate.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script src="assets/js/common.js"></script>

<script>
	var _global = {
		v: {
		},
		fn: {
			init: function() {
                this.userinfo();
                this.submitEvent();
			},
            // 补全信息
            userinfo: function() {
                var self = this,
                    $jgoosList = $('#jgoosList'),
                    idx = $jgoosList.find('.cnt').length;

                // 添加商品
                $('#jaddNewGoods').on('click', function() {
                    $jgoosList.append('<div class="cnt"> \n <div class="ipt-wrap"><input type="text" name="goods' + (++idx) + '" id="goods' + (++idx) + '" class="ipt" autocomplete="off"></div> \n <button type="button" class="ubtn ubtn-red ml">删除</button> \n </div>');
                    self.searchProduct($('#goods' + idx));
                })

                // 删除价格
                $jgoosList.on('click', '.ubtn-red', function(){
                    $(this).prev().find('.ipt').autocomplete('dispose');
                    $(this).parent().remove();
                })

                self.searchProduct($('#goods1'));

            },
			// 查询品种
			searchProduct: function($ele) {
				$ele.autocomplete({
                    serviceUrl: 'json/catName.json',
                    paramName: 'name',
                    deferRequestBy: 100,
                    showNoSuggestionNotice: true,
                    noSuggestionNotice: '没有该品种',
                    transformResult: function (response) {
                        response = JSON.parse(response);
                        if (response.status == "y") {
                            return {
                                suggestions: $.map(response.data, function (dataItem) {
                                    return {value: dataItem.name, data: dataItem.id};
                                })
                            };
                        } else {
                            return {
                                suggestions: []
                            }
                        }
                    },
                    onSelect: function (suggestion) {
                    }
                });
			},
            // 提交事件
            submitEvent: function() {
                var self = this,
                    $trace = $('#trace'),
                    $pa = $trace.parent(),
                    $visitorForm = $('#visitorForm'),
                    $expressForm = $('#expressForm');

                // 关闭弹层
                $expressForm.on('click', '.ubtn-gray', function () {
                    layer.closeAll();
                })

                // 关闭弹层
                $visitorForm.on('click', '.ubtn-gray', function () {
                    layer.closeAll();
                })

                // 
                $('#saveUserinfo').on('click', function() {
                    layer.msg('aaa', {offset: '80%'});
                    return false;
                })
                // 同意寄样
                $pa.on('click', '.submit1', function() {
                    self.submit1();
                    return false;
                })

                // 拒绝寄样
                $pa.on('click', '.submit2', function(){
                    self.submit2();
                    return false;
                })
                
                // 寄送样品
                $pa.on('click', '.submit3', function(){
                    $expressForm[0].reset();
                    self.layerForm($expressForm, '快递信息');                    
                    return false;
                })                

                // 客户来访
                $pa.on('click', '.submit4', function(){
                    $visitorForm[0].reset();
                    self.layerForm($visitorForm, '来访信息');
                    return false;
                })

                // 提交记录
                $pa.on('click', '.submit5', function(){
                    var text = $('#traceForm').find('.ipt').val();
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                date: '2016年10月20日 15:20',
                                operator: 'frank',
                                msg: text
                            }
                            $('#traceForm').find('.ipt').val('');
                            self.addNewRevord(data);
                        }
                    })
                })

                // 寄样完成
                $pa.on('click', '.submit6', function() {
                    layer.confirm('寄样完成后不能进行跟踪记录操作，是否确认', {
                        btn: ['确认','取消'] //按钮
                    }, function(index){
                        $('#traceForm').remove();
                        layer.close(index);
                    });
                })

                // 快递信息验证
                $expressForm.validator({
                    fields: {
                        express: '快递公司: required',
                        expressNum: '快递单号: required'
                    },
                    valid: function (form) {
                        $.ajax({
                            url: '',
                            data: $expressForm.serialize(),
                            success: function(data) {
                                data = {
                                    date: '2016年10月20日 15:20',
                                    operator: 'frank',
                                    express: '顺丰快递',
                                    expressNum: '11454114141'
                                }
                                self.addNewRevord(data);
                                $('.submit3').parent().remove();
                                $('#traceForm').show();
                                layer.closeAll();
                            }
                        })
                    }
                });
                
                // 来访信息验证
                $visitorForm.validator({
                    fields: {
                        visitor: '来访人: required',
                        visitorMobile: '来访人电话: required; mobile',
                        visitorDate: '日期: required'
                    },
                    valid: function (form) {
                        $.ajax({
                            url: '',
                            data: $visitorForm.serialize(),
                            success: function(data) {
                                data = {
                                    date: '2016年10月20日 15:20',
                                    operator: 'frank',
                                    visitorDate: '2016年10月22日 10:20',
                                    visitor: '王彬',
                                    visitorMobile: '18801285391'
                                }
                                self.addNewRevord(data);
                                $('.submit3').parent().remove();
                                $('#traceForm').show();
                                layer.closeAll();
                            }
                        })
                    }
                });

                // 来访日期
                laydate({
                    elem: '#visitorDate',
                    format: 'YYYY-MM-DD hh:mm:ss',
                    min: laydate.now(), //设定最小日期为当前日期
                    istime: true,
                    choose: function(date){
                        $('#visitorDate').trigger('validate');
                    }
                })
            },
            // 同意寄样
            submit1: function() {
                layer.prompt({
                    moveType: 1,
                    formType: 2,
                    title: '同意原因',
                    btn: ['同意', '关闭']
                }, function(text, index) {
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                operator: 'frank',
                                date: '2016年10月20日 15:20',
                                msg: text
                            }
                            $('#trace').append('<li><span>' + data.date + '</span><span>操作人：' + data.operator + '</span><span>同意寄样</span></li><li><span>同意理由：' + data.msg + '</span></li>');
                            $('.submit2').parent().remove();
                            $('.submit3').parent().show();
                        }
                    })
                    layer.close(index);
                });
            },
            // 拒绝寄样
            submit2: function() {
                layer.prompt({
                    moveType: 1,
                    formType: 2,
                    title: '拒绝原因',
                    btn: ['拒绝', '关闭']
                }, function(text, index) {
                    $.ajax({
                        url: '',
                        data: {msg: text},
                        success: function(data) {
                            data = {
                                operator: 'frank',
                                date: '2016年10月20日 15:20',
                                msg: text
                            }
                            $('#trace').append('<li><span>' + data.date + '</span><span>操作人：' + data.operator + '</span><span>拒绝寄样</span></li><li><span>拒绝理由：' + data.msg + '</span></li>');
                            $('#trace').nextAll().remove();
                        }
                    })
                    layer.close(index);
                });
            },
            // 表单
            layerForm: function(modal, title) {                
                layer.open({
                    area: ['600px'],
                    type: 1,
                    moveType: 1,
                    content: modal,
                    title: title
                });
            },
            // 添加记录
            addNewRevord: function(data) {
                var html = [];
                $.each(data, function(i, item) {
                    html.push('<span>' + item + '</span>');
                })
                html.length > 1 && $('#trace').append('<li>' + html.join('') + '</li>');
            } 
		}
	}

	$(function() {
		_global.fn.init();
	})
</script>
</body>
</html>