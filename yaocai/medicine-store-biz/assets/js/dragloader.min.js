!function(e){var t=e.document,o=e.navigator,r=o.msPointerEnabled,s={start:r?"MSPointerDown":"touchstart",move:r?"MSPointerMove":"touchmove",end:r?"MSPointerUp":"touchend"},n=function(){for(var e,o="t,webkitT,MozT,msT,OT".split(","),r=t.createElement("div").style,s=0,n=o.length;n>s;s++)if(e=o[s]+"ransform",e in r)return r=null,o[s].substr(0,o[s].length-1);return r=null,!1}(),i=function(e){return""===n?e:(e=e.charAt(0).toUpperCase()+e.substr(1),n+e)},a=i("transition"),h=function(){return"webkit"==n||"O"===n?n.toLowerCase()+"TransitionEnd":"transitionend"}(),d=function(e,t,o){var r=this,s=function(){e.transitionTimer&&clearTimeout(e.transitionTimer),e.transitionTimer=null,e.removeEventListener(h,n,!1)},n=function(){s(),o&&o.call(r)};s(),e.addEventListener(h,n,!1),e.transitionTimer=setTimeout(n,t+100)},l={threshold:80,dragDownThreshold:80,dragUpThreshold:80,dragDownClass:"dragger-down",dragUpClass:"dragger-up",dragUpDom:{before:"向下拉加载最新",prepare:"释放刷新",load:"加载中..."},dragDownDom:{before:"向上拉加载更多",prepare:"释放加载",load:"加载中..."}};e.DragLoader=function(e,o){var r=this;r.obj=e?"string"==typeof e?t.querySelector(e):e:t.body,o=o||{};for(var n in l)void 0===o[n]&&(o[n]=l[n]);r.options=o,r._events={},r._draggable=!0,r.obj.addEventListener(s.start,r,!1)},DragLoader.prototype={STATUS:{before:"before",prepare:"prepare",load:"load"},handleEvent:function(e){switch(e.type){case s.start:this._onTouchStrat(e);break;case s.move:this._onTouchMove(e);break;case s.end:this._onTouchEnd(e)}},_createDragDownRegion:function(){return this._removeDragDownRegion(),this.header=t.createElement("div"),this.header.className=this.options.dragDownClass,this._touchCoords.status=this._processStatus("down",0,null,!0),this.obj.insertBefore(this.header,this.obj.children[0]),this.header},_removeDragDownRegion:function(){this.header&&(this.obj.removeChild(this.header),this.header=null)},_createDragUpRegion:function(){return this._removeDragUpRegion(),this.footer=t.createElement("div"),this.footer.className=this.options.dragUpClass,this._touchCoords.status=this._processStatus("up",0,null,!0),this.obj.appendChild(this.footer),this.footer},_removeDragUpRegion:function(){this.footer&&(this.obj.removeChild(this.footer),this.footer=null)},_processDragDownHelper:function(e){var t=this;t.options.preventDragHelper||(t.header.innerHTML="<span>"+t.options.dragDownDom[e]+"</span>")},_processDragUpHelper:function(e){var t=this;t.options.preventDragHelper||(t.footer.innerHTML="<span>"+t.options.dragUpDom[e]+"</span>")},_processStatus:function(e,t,o,r){var s,n,i=this.options,a=this.STATUS,h=o;return e&&(n=e.charAt(0).toUpperCase()+e.substr(1),s=t>i["drag"+n+"Threshold"],s||o==a.before?r&&s&&o!=a.prepare?(this["_processDrag"+n+"Helper"].call(this,a.prepare),this._fireEvent("drag"+n+"Prepare"),h=a.prepare):!r&&s&&o!=a.load&&(this["_processDrag"+n+"Helper"].call(this,a.load),this._fireEvent("drag"+n+"Load"),h=a.load):(this["_processDrag"+n+"Helper"].call(this,a.before),this._fireEvent("drag"+n+"Default"),h=a.before)),h},_onTouchStrat:function(o){this.obj.removeEventListener(s.move,this,!1),this.obj.removeEventListener(s.end,this,!1),!this._draggable||this.options.disableDragDown===!0&&this.options.disableDragUp===!0||this._fireEvent("beforeDrag")===!1||(this._draggable=!1,this.obj.addEventListener(s.move,this,!1),this.obj.addEventListener(s.end,this,!1),this._touchCoords={},this._touchCoords.startY=r?o.screenY:o.touches[0].screenY,this._touchCoords.startScrollY=this.obj===t.body?e.pageYOffset||e.scrollY||t.documentElement.scrollTop:this.obj.scrollTop)},_onTouchMove:function(t){var o,s,n=this.obj,i=this.header,a=this.footer,h=this.options,d=e.innerHeight,l=n.scrollHeight,p=this._touchCoords,g=p.startScrollY,c=p.blockY,u=p.startY,f=r?t.screenY:t.touches[0].screenY;"undefined"==typeof p.canDragDown&&(p.canDragDown=h.disableDragDown!==!0&&f>u&&0>=g),"undefined"==typeof p.canDragUp&&(p.canDragUp=h.disableDragUp!==!0&&u>f&&g+d>=l),p.canDragDown&&p.dragUp!==!0&&(p.dragDown||0>u-f+g)?(t.preventDefault(),p.dragDown=!0,i||(i=this._createDragDownRegion()),"undefined"==typeof c&&(p.blockY=c=f),o=f-c,o=o>0?o:0,s=o-h.dragDownThreshold,s>100?o=h.dragDownThreshold+75+.25*(s-100):s>50&&(o=h.dragDownThreshold+50+.5*(s-50)),i.style.height=o+"px",p.status=this._processStatus("down",o,p.status,!0)):p.canDragUp&&p.dragDown!==!0&&(p.dragUp||u-f+g+d>l)?(t.preventDefault(),p.dragUp=!0,a||(a=this._createDragUpRegion()),"undefined"==typeof c&&(p.blockY=c=f),o=c-f,o=o>0?o:0,s=o-h.dragUpThreshold,s>100?o=h.dragUpThreshold+75+.2*(s-100):s>50&&(o=h.dragUpThreshold+50+.5*(s-50)),n.scrollTop=g+o,a.style.height=o+"px",p.status=this._processStatus("up",o,p.status,!0)):(this._draggable=!0,p.blockY=f)},_onTouchEnd:function(){this.obj.removeEventListener(s.move,this,!1),this.obj.removeEventListener(s.end,this,!1),this._translate()},_translate:function(){var e,t,o,r,s,n,i,h=this,l=h.options,p=h._touchCoords,g=200,c=function(){p.status=h._processStatus(e,o,p.status,!1),e&&p.status===h.STATUS.load?"down"==e?(h._removeDragUpRegion(),"function"==typeof l.dragDownLoadFn&&l.dragDownLoadFn.call(h)):"up"==e&&(h._removeDragDownRegion(),"function"==typeof l.dragUpLoadFn&&l.dragUpLoadFn.call(h)):(h._removeDragDownRegion(),h._removeDragUpRegion(),h._touchCoords=null,h._draggable=!0)};p&&(e=p.dragDown?"down":p.dragUp?"up":null,e?(t="down"==e?h.header:h.footer,o=t.offsetHeight,n=e.charAt(0).toUpperCase()+e.substr(1),i=l["drag"+n+"Threshold"],r=!l.preventDragHelper&&o>i?i:0,s=Math.ceil((o-r)/i*g),s=s>g?g:s,d(t,s,c),t.style[a]="height "+s+"ms",setTimeout(function(){t.style.height=r+"px"},0)):c())},reset:function(){this._translate()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){this._events[e]&&this._events[e].every(function(o,r){return o===t?(this._events[e].splice(r,1),!1):void 0})},_fireEvent:function(e,t){var o,r=this;return r._events[e]&&r._events[e].forEach(function(e){o=e.apply(r,t||[])}),o},setDragDownDisabled:function(e){this.options.disableDragDown=e},setDragUpDisabled:function(e){this.options.disableDragUp=e},destroy:function(){this.destroyed||(this.destroyed=!0,this._removeDragDownRegion(),this._removeDragUpRegion(),this.obj.removeEventListener(s.start,this,!1),this.obj.removeEventListener(s.move,this,!1),this.obj.removeEventListener(s.end,this,!1),this.obj=null)}}}(window);