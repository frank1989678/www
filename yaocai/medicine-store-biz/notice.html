<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>药商头条-药优优</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="assets/css/app.css">
</head>
<body>
    <div class="ui-content">
        <div class="scroll-menu">
            <a href="?id=1" class="curr">行情</a>
            <a href="?id=2">热点</a>
            <a href="?id=0">产地</a>
            <a href="?id=2">热点</a>
            <a href="?id=0">产地</a>
            <a href="?id=2">热点</a>
            <a href="?id=0">产地</a>
            <a href="?id=2">热点</a>
            <a href="?id=0">产地</a>
            <a href="?id=2">热点</a>
            <a href="?id=0">产地</a>
        </div>

        <div class="news2">
            <ul id="plist"></ul>
        </div>
    </div>
    <div class="copyright">
        <p>亳州市东方康元中药材信息咨询有限公司</p>
        <p>版权所有 2016-2017</p>
    </div>

    <script src="assets/js/zepto.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script>

    var _global = {
        fn: {
            init: function() {
                this.loadPlist();
            },
            loadPlist: function() {
                var that = this;
                that.pageNum = 1; // 当前页

                that.me = $('.ui-content').dropload({
                    scrollArea: window,
                    threshold: 50,
                    loadDownFn: function(){
                        that.getData({
                            pageNum: that.pageNum
                        });
                    }
                });
            },
            getData: function(parameter) {
                var that = this;
                $.ajax({
                    type: 'GET',
                    url: 'json/notice.json',
                    dataType: 'json',
                    data: parameter,
                    success: function(res){
                        if (res.isLastPage) {
                            that.me.lock();
                            that.me.noData();
                        }
                        that.toHtml(res.list);
                        that.pageNum ++;
                    },
                    error: function(xhr, type){
                        popover('网络连接超时，请您稍后重试!');
                    },
                    complete: function() {
                        that.me.resetload();
                    }
                });
            },
            toHtml: function(data) {
                var html = [];
                $.each(data, function(i, item) {
                    html.push('<li>\n');
                    html.push(     '<div class="cnt">\n');
                    html.push(         '<div class="name"><a href="' + item.href + '">', item.title, '</a></div>\n');
                    html.push(         '<div class="cat">');
                    $.each(item.cat, function(j, cat) {
                        html.push('<span>', cat, '</span>');
                    })
                    html.push(         '</div>\n');
                    html.push(         '<div class="time">\n');
                    html.push(              '<span class="">阅读数：', item.readnum, '</span>\n');
                    html.push(              '<time>', _YYY.timeago.elapsedTime(item.time, true), '</time>\n');
                    $.each(item.tag, function(k, tag) {
                        html.push('<a href="?tag=" class="ui-tag">', tag, '</a>');
                    })
                    html.push(          '</div>\n');
                    html.push(     '</div>');
                    html.push(     '<div class="pic"><img src="', item.pic, '" width="110" height="90" alt="', item.title, '"></div>\n');
                    html.push('</li>');
                })
                $('#plist').append(html.join(''));
            },
            empty: function(isEmpty) {
                if (isEmpty) {
                    $('.ui-content').prepend('<div class="ui-notice ui-notice-extra"> \n 品种列表还没有商品，<br>去商品详情页面可以添加商品到选货单！ \n <a class="ubtn ubtn-primary" href="/">返回首页</a> \n </div>');
                }
            },
            loading: function() {
                var self = this,
                    $ul = $('.news').find('ul');

                $.ajax({
                    type: 'GET',
                    url: '../json/news.json',
                    dataType: 'json',
                    data: {pagesize: self.pagesize},
                    success: function(data){
                        if (!data.list) {
                            return;
                        }
                        var result = self.toHtml(data.list);
                        $ul.append(result);
                        if (data.nomore) {
                            $('body').append('<div class="nomore">没有更多了...</div>');
                            self.dragger.options.disableDragUp = true;
                        }
                        self.pagesize ++;
                    },
                    error: function(xhr, type){
                        popover('网络连接超时，请您稍后重试!');
                    },
                    complete: function() {
                        self.dragger.reset();
                    }
                });
            },
            loadmore: function() {
                var self = this;

                self.dragger = new DragLoader(document.body, {
                    disableDragDown: true,
                    dragUpLoadFn: function() {
                        self.loading();
                    }
                });
            },
            toHtml2: function(data) {
                var html = [];
                $.each(data, function(i, item) {
                    html.push('<li>\n');
                    html.push(         '<div class="title">', data[i].title, '</div>\n');
                    html.push(         '<time>', data[i].date, '</time>\n');
                    html.push(         '<div class="summary"><a href="notice_info.html">', data[i].summary, '</a></div>\n');
                    html.push('</li>');
                })
                return html.join('');
            }
        }
    }

    $(function(){
        _global.fn.init();

    });

</script>
</body>
</html>