<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>开黑陪玩-快速专业的打团平台</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div class="wrap">
<div class="form">
    <form name="myform" id="myform">
        <ul class="form2">
            <li>
                <label class="for">兑&nbsp;&nbsp;换&nbsp;&nbsp;码</label>
                <input type="text" name="code" class="ipt" autocomplete="off" placeholder="请输入您购买后获得的兑换码" data-msg="请输入兑换码">
                <span class="err"></span>
            </li>
            <li class="button">
                <button type="submit" class="btn btn-query2">查询</button>
                <span class="btn-back">
                    <a class="back" href="index.html">返回上一级 &gt;</a>
                </span>
            </li>
        </ul>
    </form>
    <div class="result">
        <ul>
            <li>
                <label class="for">兑换码：</label>
                <span class="txt" data-key="series"></span>
            </li>
            <li>
                <label class="for">服务：</label>
                <span class="txt" data-key="type"></span>
            </li>
            <li class="region">
                <label class="for">跨区：</label>
                <span class="txt" data-key="gameArea"></span>
            </li>
            <li>
                <label class="for">角色名：</label>
                <span class="txt ell" data-key="rolename"></span>
            </li>
            <li>
                <label class="for">手机号码：</label>
                <span class="txt" data-key="mobile"></span>
            </li>
            <li>
                <label class="for">状态：</label>
                <span class="txt" data-key="statusStr"></span>
            </li>
            <li class="tip">
                提示：后续您可以通过兑换码来查询订单状态。
            </li>
            <li class="btn-back">
                <a class="back" href="index.html">返回上一级 &gt;</a>
            </li>
        </ul>
    </div>
</div>

<div class="foot">
    <dl>
        <dt><img width="90" height="90" src="images/qrcode.png" alt="二维码"></dt>
        <dd class="txt">客户服务请扫描二维码获取或联系 QQ：80240825</dd>
    </dl>
</div>
</div>

<!-- 公用 -->
<script src="js/jquery191.js"></script>
<script>
!(function($) {
    var baseURL = 'https://t-api-play.wzpeilian.com';

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    function query(code) {
        console.log(code)
        $.ajax({
            url: baseURL + '/open/v1/cdk/query',
            type: 'POST',
            dataType: 'json',
            data: {series: code},
            success: function(res) {
                console.log(res)
                if (res.status === 200) {
                    var data = res.data || [];
                    $('.result').show().find('.txt').each(function() {
                        var key = $(this).data('key');
                        $(this).html(data[key] || '');
                    })
                    if (data.type.indexOf('阿古斯') === -1) {
                        $('.region').show();
                    } else {                            
                        $('.region').hide();
                    }
                    $('.form2').hide();
                    $('.err').hide();
                } else {
                    $('.err').html(res.msg).show();
                    $('.result').hide()
                    $('.form2').show();
                }
            },
            error: function() {
                $('.err').html('网络错误').show();
                $('.result').hide()
                $('.form2').show();
            }
        })
    }

    var series = getQueryString('series');

    if (series) {
        console.log(series)
        query(series);
    }

    $('.ipt').on('focus', function() {
        $(this).closest('li').find('.err').hide().empty();
    })

    $('#myform').on('submit', function() {
        var pass = true;
        var val = '';
        $('.ipt').each(function() {
            val = $.trim(this.value);
            if (val.length === 0) {
                pass = false;
                $(this).next('.err').html($(this).data('msg')).show();
            } else {
                $(this).next('.err').hide().empty();
            }
            return pass;
        })
        if( pass ) {
            query(val)
        }
        return false;
    })
})(jQuery)
</script>
</body>
</html>