<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>百度地图</title>
    <link rel="stylesheet" href="css/drawingManager.css" />
    <style>
    html,
    body {
        height: 100%;
    }
    #map {
        height: 100%;
    }
    </style>
</head>

<body>
    <div id="map"></div>
    <script src="http://api.map.baidu.com/api?v=2.0&ak=pcExWaLfoopv7vZ5hO1B8ej8"></script>
    <script src="js/baidu.pois.js"></script>
    <script src="js/baidu.tools.js"></script>
    <script src="js/LuShu.js"></script>
    <script src="js/jquery191.js"></script>
    <script>
    
    var i = 0,
        len = arrPois.length,
        duration = 2e3;

    var map = new BMap.Map('map');
    map.centerAndZoom(arrPois[0], 18);
    // 启用滚轮放大缩小
    map.enableScrollWheelZoom();

    // 鼠标工具，绘制圆形、矩形、多边形
    drawingManager();

    var carPlace = {
        init: function() {
            this.driving();
        },
        driving: function() {
            var that = this,
                i = 1,
                len = arrPois.length,
                duration = 2e3;

            var point = [arrPois[0]];

            var carRed = new BMap.Icon('images/car1.png', new BMap.Size(52,26),{anchor: new BMap.Size(26, 13)});
            var carGray = new BMap.Icon('images/car2.png', new BMap.Size(52,26),{anchor: new BMap.Size(26, 13)});

            var car1 = new LuShu(map, point,{
                defaultContent: '鄂A39201',
                // showPath: true,
                icon: carRed,
                duration: duration,
                isCross: true,
                crossFn: function(isCross, overlay, car) {
                    if (isCross) {
                        console.log('鄂A39201离开' + overlay.name);
                        var pos = car.getRotation();
                        car.setIcon(carGray);
                        car.setRotation(pos);
                    } else {
                        console.log('鄂A39201进入' + overlay.name);
                        var pos = car.getRotation();
                        car.setIcon(carRed);
                        car.setRotation(pos);
                    }
                },
                setStatus: function(car) {
                    var pos = car.getRotation();
                    car.setIcon(carRed);
                    car.setRotation(pos);
                }
            });

            // 实时定位车辆
            function callback(i, time1) {
                var point = [arrPois[i-1], arrPois[i]];
                var time2 = (new Date).getTime();
                var time = (time2 - time1);
                car1.move(point, time);
            }

            // 定时器
            var timer = setInterval(function() {
                if (++i < len) {
                    var time1 = (new Date).getTime();
                    // $.ajax({
                    //     url: '../ajax.php',
                    //     data: {time: Math.round(Math.random() * 1000)},
                    //     success: function(res) {
                            callback(i, time1);
                        // } 
                    // })
                } else {
                    clearInterval(timer);
                }
            }, duration);
        }
    }

    carPlace.init();
    </script>
</body>

</html>