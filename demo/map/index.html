<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" content="no-store"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>武汉110作战指挥中心调度平台</title>
    <meta name="renderer" content="webkit" />
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
    <script src="/static/js/jquery191.js"></script>
    <style>
    .map-area{position:absolute;top:0;left:0;right:0;bottom:0;}
    .map-style{position:absolute;top:10px;right:10px;width:350px;font-size:0;}
    .map-style label{display:inline-block;width:50px;margin:0 5px 5px 0;border:1px solid #999;border-radius:3px;text-align:center;font-size:14px;background:#fff;cursor:pointer;}
    .map-style label:hover{background:#f90;}
    .map-style .curr{background:#c30;color:#fff;}
    .map-search{position:absolute;top:70px;right:20px;}
    .map-search .keyword{width:340px;height:24px;border:1px solid #ddd;}
    </style>
</head>
<body>

<div class="map-area" id="j_map"></div>


<div class="map-style">
    <label value='normal' class="curr">标准</label>
    <label value='dark'>幻影黑</label>
    <label value='light'>月光银</label>
    <label value='fresh'>草色青</label>
    <label value='grey'>雅士灰</label>
    <label value='graffiti'>涂鸦</label>
    <label value='whitesmoke'>远山黛</label>
    <label value='macaron'>马卡龙</label>
    <label value='blue'>靛青蓝</label>
    <label value='darkblue'>极夜蓝</label>
    <label value='wine'>酱籽</label>
</div>

<div class="map-search">
    <input class="keyword" id="tipinput" />
</div>

<script src="http://webapi.amap.com/maps?v=1.4.0&amp;key=9d870244cd940650899a73c0566d7652&amp;plugin=AMap.MouseTool,AMap.Scale,AMap.OverView,AMap.ToolBar,AMap.Autocomplete,AMap.PlaceSearch,AMap.IndoorMap"></script>


<script>

var map;
var mapControl = {
    amap: function() {
        var that = this;
        var scale = new AMap.Scale(),
        toolBar = new AMap.ToolBar(),
        overView = new AMap.OverView();

        var indoorMap = new AMap.IndoorMap({alwaysShow:true});

        // 初始化地图
        map = new AMap.Map('j_map', {
            resizeEnable: true,
            // mapStyle: 'amap://styles/grey',
            zooms:[3,20],
            zoom: 18,
            center: [114.34027, 30.552757],
            expandZoomRange:true,
            // showIndoorMap:false,//隐藏地图自带的室内地图图层
            // layers:[indoorMap],
            pitch:75
        });
        map.addControl(scale);
        map.addControl(toolBar);
        map.addControl(overView);


        map.on('indoor_create',function(e) {
            console.log(e)
            map.indoorMap.showIndoorMap('B000A856LJ',5);
        })

        setTimeout(function() {
            map.setCenter([114.34027, 30.552757]);
        }, 1e3)

        this.bindEvent();
        this.search();
    },
    setStyle: function(enName) {
        map.setMapStyle('amap://styles/'+enName);
    },
    bindEvent: function() {
        var that = this;
        $('.map-style').on('click', 'label', function() {
            $(this).addClass('curr').siblings().removeClass('curr');
            that.setStyle($(this).attr('value'));
        })

        map.on('click', function(e) {
            console.log(e.lnglat.lng + ',' + e.lnglat.lat);
        })
    },
    search: function() {
        var auto = new AMap.Autocomplete({
            input: 'tipinput'
        });
        var placeSearch = new AMap.PlaceSearch({
            map: map
        });
        AMap.event.addListener(auto, 'select', function(e) {
            placeSearch.setCity(e.poi.adcode);
            placeSearch.search(e.poi.name);
        });
    }
}
mapControl.amap();

</script>

</body>
</html>