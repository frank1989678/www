<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>角色管理</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/select2/select2.css" />
</head>
<body>

<!-- header begin -->
<div class="header cf">
	<div class="logo">
		<a href="index.html">武汉市车管所制证管理系统</a>
	</div>
	<div class="user"></div>
</div>
<!-- header end -->

<div class="side-menu">
	<dl>
		<dt>
			<a href="javascript:;">
				<i class="icon icon-1"></i>
				<span>流水打印管理</span>
				<i class="icon arrow"></i>
			</a>
		</dt>
		<dd>
			<a href="printManage.html">待打印信息</a>
			<a href="printHis.html">已打印查询</a>
		</dd>
	</dl>
	<dl>
		<dt>
			<a href="javascript:;">
				<i class="icon icon-2"></i>
				<span>制证管理</span>
				<i class="icon arrow"></i>
			</a>
		</dt>
		<dd>
			<a href="ab1.html">证件登记上屏</a>
			<a href="ab2.html">接收数据维护</a>
		</dd>
	</dl>
	<dl>
		<dt>
			<a href="javascript:;">
				<i class="icon icon-3"></i>
				<span>统计分析</span>
			</a>
		</dt>
	</dl>
	<dl>
		<dt>
			<a href="javascript:;">
				<i class="icon icon-4"></i>
				<span>系统管理</span>
				<i class="icon arrow"></i>
			</a>
		</dt>
		<dd>
			<a href="departmentManage.html">部门管理</a>
			<a href="roleManage.html">角色管理</a>
			<a href="purviewManage.html">权限管理</a>
			<a href="userManage.html">用户管理</a>
		</dd>
	</dl>
</div>

<div class="content">
	<div class="box">
		<div class="tit">角色管理</div>

		<div class="filter">
			<form name="filterForm" id="filter" onsubmit="return false;">
				<label class="for">角色名称</label>
				<input class="ipt" name="roleName" type="text">
				<button type="submit" class="ubtn ubtn-primary">查询</button>
			</form>
		</div>


		<div class="operate">
			<button type="button" class="ubtn ubtn-cyan" id="modify">修改</button>
			<button type="button" class="ubtn ubtn-cyan" id="del">删除</button>
			<button type="button" class="ubtn ubtn-cyan" id="add">新增</button>
		</div>

		<div class="table mt15">
			<script id="tableTemp" type="text/html">
				{{each list as item i}}
				<tr>
					<td><label class="icheck" data-id="{{item.id}}"></label></td>
					<td>{{item.id}}</td>
					<td>{{item.roleName}}</td>
					<td>{{item.note}}</td>
					<td>
						<a href="roleLimits.html" data-id="{{item.id}}" class="ubtn ubtn-link">设置权限</a>
					</td>
				</tr>
				{{/each}}
			</script>
			<table class="tc">
				<thead>
					<tr>    
						<th><label class="icheck"></label></th>
						<th>序号</th>
						<th>角色名称</th>
						<th>备注</th>
						<th>管理</th>
					</tr>
				</thead>
				<tbody id="tbody"></tbody>
			</table>
		</div>
		
		<div class="operate">
			<div class="pagination"></div>
		</div>
	</div>

</div>

<div class="footer">
	<span>湖北省宏锐慧通信息技术有限公司</span>
</div>



<div class="form layer-form" id="tempForm">
	<div class="title">新增角色</div>
	<form name="form1" onsubmit="return false;">
		<div class="item">
            <div class="txt">角色名称：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="roleName" data-msg="你还未填写角色名称，请先完善信息"  />
            </div>
        </div>
		<div class="item">
            <div class="txt">备注：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="note"  />
            </div>
        </div>
	    <div class="ft">
	        <button type="button" class="ubtn ubtn-gray layer-close">关闭</button>
	        <button type="submit" class="ubtn ubtn-primary submit" style="width:120px;">确定</button>
	    </div>
	</form>
</div>

<!-- 公用 -->
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/js/common.js"></script>

<!-- 页面专用 -->
<link rel="stylesheet" href="assets/plugins/zTreeStyle/jquery.ztree.css" />
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/ajaxPage.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>


<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) -->
<script src="assets/js/mock.js"></script>
<script>
	Mock.mock('http://g.cn', {
		"result": "SUCCESS",
	    "totalSize": 131,
	    "list|10": [{
		    "id": "@increment",
		    "roleName": "@ctitle",
		    "note": "@ctitle"
		}]
	});

</script>
<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) end -->


<script>
var zNodes =[
	{ id:1, pId:0, name:"武汉市交管局", open:true},
	{ id:11, pId:1, name:"交管局车管所"},
	{ id:111, pId:11, name:"牌证科"},
	{ id:112, pId:11, name:"车管所屯口分所"},
	{ id:12, pId:1, name:"交管局车管所服务站"},
	{ id:13, pId:1, name:"武汉市江岸大队"}
];


// 设置高亮字体
function setHighlight(treeId, treeNode) {
    return (treeNode.highlight) ? {'color':'#f8503f'} : {};
}
function beforeClick(treeId, treeNode) {
	var zTree = $.fn.zTree.getZTreeObj("department");
	zTree.checkNode(treeNode, !treeNode.checked, null, true);
	return false;
}
function addDiyDom(treeId, treeNode) {
	$("#" + treeNode.tId + "_switch").before('<div class="col1"><label class="icheck" data-id="' + treeNode.id +  '"></label></div>')
}

var _global = {
	init: function() {
		this.filter();
        this.bindEvent();
	},
	filter: function() {
		var that = this;
		var $form = $('#filter');
		var page =  new Page({
			pageIndex: 1, // 当前页
			pageSize: 10, // 每页显示10条
			url: 'http://g.cn',
			callback: function(res) {
				$('#tbody').empty().html(template('tableTemp', res));
			}
		})

		// 查询
		$form.on('submit', function() {
			var filterData = $form.serializeArray();
			page.request(filterData);
			return false;
		})
	},
	getNodeId: function(multiple) {
    	var nodeIds = [];
		$('#tbody').find('.cbx-on').each(function() {
			nodeIds.push($(this).data('id'));
		})
		if (nodeIds.length === 0) {
        	$.notify({'content': '请先选择需要操作的角色!', type: 'danger'});
		} else if (nodeIds.length > 1 && !multiple) {
			$.notify({'content': '请选择一项进行操作!', type: 'danger'});
        } else {
			return nodeIds;
        }
        return false;
    },
    bindEvent: function() {
		var that = this,
			$temp = $('#tempForm'),
			$form = $temp.find('form'),
			opType = 'add';

		// 验证
		$form.validator({
            fields: {
                roleName: 'required'
            },
            valid: function(form) {
            	var url = 'role/' + opType,
            		data = $(form).serialize();

            	fx.required(url, data, function(res) {
            		layer.closeAll();
			        fx.succeed({
			        	title: opType === 'add' ? '新增成功！' : '保存成功！',
			        	okeyValue: '返回'
			        })
            	})
				return false;
            }
        });

		// 新增
		$('#add').on('click', function() {
			opType = 'add';
			$form[0].reset();
			$form.prev('.title').html('新增');
			layer.open({
				area: '540px',
				type: 1,
				title: false,
				content: $temp
			})
		})

        // 修改
        $('#modify').on('click', function() {
        	var id = that.getNodeId();
			opType = 'edit';
			$form[0].reset();
			$form.prev('.title').html('修改');
			if (id) {
				fx.request('http://h.cn', {id: id}, function(res){
					$form.find('.ipt[name="roleName"]').val(res.data.roleName);
					$form.find('.ipt[name="note"]').val(res.data.note);
					layer.open({
						area: '540px',
						type: 1,
						title: false,
						content: $temp
					})
				});
			}
        })

		// 删除
		$('#del').on('click', function() {
			var id = that.getNodeId(true);
        	var okey = function() {
				fx.request('url', {id: id}, function(res) {

				})
				layer.closeAll();
			}
			id && fx.confirm('确定删除？', okey);
		})
    }
}

</script>
</body>
</html>