<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>车管所智能管控平台</title>
    <meta name="renderer" content="webkit" />
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/style.css" />
	<link rel="stylesheet" href="assets/plugins/date/daterangepicker.min.css" />
	<script src="assets/js/jquery191.js"></script>
</head>
<body>

<!-- header begin -->
<div class="header">
	<div class="logo">
		<a href="index.html"><em>车管所智能管控平台</em>Intelligent management and control platform of vehicle administ</a>
	</div>

	<div class="nav">
		<ul>
			<li><a href="user.html"><i class="ico ico-1"></i>用户管理</a></li>
			<li><a href="usertype.html"><i class="ico ico-2"></i>用户类型管理</a></li>
			<li><a href="systype.html"><i class="ico ico-3"></i>系统类型管理</a></li>
			<li><a href="setting.html"><i class="ico ico-4"></i>外挂系统配置</a></li>
		</ul>
	</div>

	<div class="user">
		<ul>
			<li><span>yitop</span><i>|</i></li>
			<li><a href="login.html"><i class="ico ico-logout"></i></a></li>
		</ul>
	</div>
</div>
<!-- header end -->

<div class="wrapper">
	<div class="tit">系统类型管理</div>
	<div class="filter">
		<form name="filterForm" id="filterForm" onsubmit="javascript:return false;" method="GET">
			<div class="cf">
				<button type="button" class="ubtn ubtn-cyan fr" onclick="_add()">新增系统</button>
			</div>
			
		</form>
	</div>

	<div class="table">
		<table class="border tc">
			<thead>
				<tr>
                    <th>序号</th>
					<th class="tl">系统类型名称</th>
                    <th>创建时间</th>
					<th width="200">操作</th>
				</tr>
			</thead>
			<tbody id="tbody"></tbody>
		</table>
		<script id="tableTemp" type="text/html">
			{{each list as item i}}
			<tr>
				<td>{{i+1}}</td>
		        <td class="tl">{{item.name}}</td>
		        <td>{{item.datetime}}</td>
				<td>
					<button type="button" class="ubtn ubtn-link" onclick="_edit({{item.id}})">编辑</button>
					<button type="button" class="ubtn ubtn-link" onclick="_del({{item.id}})">删除</button>
				</td>
			</tr>
			{{/each}}
		</script>
	</div>
	
	<div class="operate">
		<div class="pagination"></div>
	</div>
</div>


<!-- 新增&编辑 -->
<div class="form layer-form" id="tempForm">
	<div class="ftit">添加</div>
	<form name="form1" onsubmit="return false;">
		<div class="item">
            <div class="txt">系统类型名称：</div>
            <div class="cnt" style="padding-left:100px;">
            	<input type="text" class="ipt" name="name" autocomplete="off" />
            	<i class="req">*</i>
            </div>
        </div>
		<div class="item hide">
            <div class="txt">创&nbsp;&nbsp;建&nbsp;&nbsp;时&nbsp;&nbsp;间&nbsp;：</div>
            <div class="cnt" style="padding-left:100px;">
            	<input type="text" class="ipt" name="datetime" value="" disabled readonly />
            </div>
        </div>
	    <div class="buttons">
	    	<input type="text" class="ipt hide" name="uid" value="0" />
	        <button type="button" class="ubtn ubtn-primary layer-close">取消</button>
	        <button type="submit" class="ubtn ubtn-primary submit" onclick="_submitForm()">确定</button>
	    </div>
	</form>
</div>
<!-- end 新增&编辑 -->

<script src="assets/js/common.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/ajaxPage.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script>
// 新增
function _add() {
	var $temp = $('#tempForm');
	var $form = $temp.find('form');
	$form[0].reset();
	$form.prev('.ftit').html('新增系统类型');
	$form.find('.item.hide').hide();
	layer.open({
		area: '570px',
		type: 1,
		title: false,
		closeBtn: 0,
		content: $temp
	})
}

// 编辑
function _edit(id) {
	var $temp = $('#tempForm');
	var $form = $temp.find('form');
	$form[0].reset();
	$form.prev('.ftit').html('编辑系统类型');
	$form.find('.item.hide').show();
	if (id) {
		$.ajax({
			url: '',
			data: {id: id},
			success: function(res) {
				res = {
					data: {
						"uid": id,
						"name": "张三",
						"datetime": "2010-11-10 15:35"
					}
				};
				$form.find('.ipt, .slt').each(function(i, item) {
					var k = res.data[this.name];
					if (typeof k === 'undefined' || k == 'undefined') {
						k = '';
					}
					this.value = k;
				})
				layer.open({
					area: '570px',
					type: 1,
					title: false,
					closeBtn: 0,
					content: $temp
				})
			}
		})
	}
}

// 提交
function _submitForm() {

}
// 删除一行
function _del(id, el) {
	fx.confirm('确定删除么？', function(k) {
		$.ajax({
			url: '',
			data: {id: id},
			success: function(res) {
				if (res.result === "SUCCESS") {
					fx.alert('删除成功！');
					$(el).closest('tr').remove();
				}
			}
		})
		layer.closeAll();
	})
}

var _global = {
	init: function() {
		this.filter();
		this.bindEvent();
	},
	filter: function() {
		var that = this;
		var $form = $('#filterForm');
		var page =  new Page({
            request: true,
            pageNum: false,
            pageInfo: false,
            pageSize: 10000,
			url: 'json/systype.json'
		})
		
		// 查询
		$form.on('submit', function() {
			var filterData = $form.serializeArray();
			page.request(true, filterData);
			return false;
		})

		that.page = page;
	},
	bindEvent: function() {
		var that = this,
            $tbody = $('#tbody'),
			$temp = $('#tempForm'),
			$form = $temp.find('form'),
            $uid = $form.find('.ipt[name="uid"]');

		// 验证
		$form.validator({
            fields: {
            	name: {
            		rule: 'required;length(~20)',
            		msg: {
            			required: '系统类型名称字段不能为空',
            			length: '最大20个字符',
            		}
            	}
            },
            valid: function(form) {
            	var url = 'json/usertype.json',
            		data = $(form).serialize(),
                    type = $uid.val(),
                    msg = '新增成功！';

            	fx.request(url, data, function(res) {
            		var roles = [];
            		$form.find('.cbxs input:checked').each(function() {
            			roles.push($(this).parent().html());
            		})
                    res = {
                        "id": type,
                        "name": $form.find('.ipt[name="name"]').val(),
                        "datetime": $form.find('.ipt[name="datetime"]').val()
                    }
                    that.page.refresh(res, type);
                    if (type != '0') {
                        msg = '保存成功！'
                    }
                    $.notify({
                        title: msg,
                        type: 'success'
                    })
                    layer.closeAll();
            	})
                // window.location.reload(true);
            }
        });
	}
}

</script>
</body>
</html>