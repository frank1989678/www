<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>武汉119作战指挥中心调度平台</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <script src="assets/js/jquery191.js"></script>
</head>
<body>

<!-- header begin -->
<div class="header cf">
    <div class="logo">
        <a href="index.html">武汉119作战指挥中心调度平台<em>Intelligent command platform for fire fighting</em></a>
    </div>
    <div class="nav">
        <ul>
            <li>
                <dl>
                <dt><i class="ico ico-1"></i>每日警情</dt>
                    <dd>
                        <a href="#">车辆监控</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-2"></i>历史统计</dt>
                    <dd>
                        <a href="alarmHotSpot.html">警情记录</a>
                        <a href="alarmRecord.html">报警记录</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-3"></i>车辆监控</dt>
                    <dd>
                        <a href="ocxClient.html">视频监控</a>
                        <a href="videoConference.html">视频会议</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-5"></i>地图管控</dt>
                    <dd>
                        <a href="track.html">车辆监控</a>
                        <a href="dispatcherManage.html">调度管理</a>
                        <a href="trackHis.html">历史轨迹</a>
                        <a href="railManage.html">电子围栏</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-6"></i>设置</dt>
                    <dd>
                        <a href="javascript:;" id="mdyH1">配置标题</a>
                        <a href="javascript:;" id="mdyPwd">修改密码</a>
                        <a href="login.html">退出</a>
                    </dd>
                </dl>
            </li>
            <li class="hide">
                <dl>
                    <dt><i class="ico ico-6"></i>系统管理</dt>
                    <dd>
                        <a href="carManage.html">车辆管理</a>
                        <a href="orgManage.html">机构管理</a>
                        <a href="userManage.html">用户管理</a>
                        <a href="roleManage.html">角色管理</a>
                        <a href="purviewManage.html">权限管理</a>
                        <a href="contactsManage.html">通讯录管理</a>
                    </dd>
                </dl>
            </li>
            <li class="admin">
                指挥长 <em>欢迎登录</em>
            </li>
            <li class="dropdown">
                <dl class="menu">
                    <dt>设置</dt>
                    <dd>
                        <a href="javascript:;" id="mdyH1">配置标题</a>
                        <a href="javascript:;" id="mdyPwd">修改密码</a>
                        <a href="login.html">退出</a>
                    </dd>
                </dl>
            </li>
        </ul>
    </div>
</div>
<!-- header end -->



<div class="side" id="side">
    <div class="search">
        <form name="search">
            <label>车辆列表</label>
            <input type="text" class="ipt" placeholder="请输车牌号" onkeyup="searchCar(this)">
            <button type="button" class="ico ico-search"></button>
            <button type="button" onclick="getCarTree(0,0,0,0)" class="ico ico-refresh"></button>
        </form>
        <div class="choose" id="autoSearch"></div>
    </div>
    <div class="tools">
        <span class="li active" onclick="getCarTree(0,0,0, 0)"><i class="ico ico-1"></i>全部车辆</span>
        <span class="li" onclick="getCarTree(2,0,0, 1)"><i class="ico ico-2"></i>在线车辆</span>
        <span class="li" onclick="getCarTree(1,0,0, 2)"><i class="ico ico-3"></i>离线车辆</span>
        <span class="li" onclick="getCarTree(0,0,1, 3)"><i class="ico ico-4"></i>出警车辆</span>
    </div>
    <div class="open"></div>
    <ul id="carTree" class="ztree"></ul>
</div>
<script src="assets/app/carTree.js"></script>


<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="assets/js/common.js"></script>
<script>
	
// 判断是否是车辆
function isCarNode(treeNode) {
    return treeNode.iconSkin === 'car';
}

// 获取ztree勾选节点的所有小车id集
function getChildCar(treeNode) {
    var ids = [];
    if (isCarNode(treeNode)) {
        ids.push(treeNode.id);
    } else if (treeNode.children) {
        $.each(treeNode.children, function (i, item) {
            ids = ids.concat(getChildCar(item));
        })
    }
    return ids;
}

// 点击机构或小车名称
function clickCarName(event, treeId, treeNode) {
    var checked = treeNode.checked;
    clickCarInput(event, treeId, treeNode, checked);
}

// 勾选机构或小车
function clickCarInput(event, treeId, treeNode, checked) {
    var ids = getChildCar(treeNode);
    if (typeof checked !== 'undefined') {
        var zTree = $.fn.zTree.getZTreeObj('carTree');
        zTree.checkNode(treeNode, !checked, true);
        zTree.cancelSelectedNode(); // 取消节点选中状态
        checked = !checked;
    } else {
        checked = treeNode.checked;
    }
}

// 车辆节点显示图标
function showIconBySon(treeId, treeNode) {
    return isCarNode(treeNode);
}

// ztree参数
var setting = {
    check: {
        enable: true,
        chkboxType: {'Y': 'ps', 'N': 'ps'}
    },
    data: {
        simpleData: {
            enable: true,
            idKey: 'id',
            pIdKey: 'pid',
            rootPId: null
        }
    },
    view: {
        dblClickExpand: false,
        // showIcon: showIconBySon,
        showLine: true
    },
    callback: {
        onClick: clickCarName,
        onCheck: clickCarInput,
        onCollapse: nodeCollapse,
        onExpand: nodeExpand
    }
}

</script>
</body>
</html>