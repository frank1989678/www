<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>权限管理</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/select2/select2.css" />
</head>
<body>

<!-- header begin -->
<div class="header cf">
	<div class="logo">
		<a href="index.html">武汉119作战指挥中心调度平台</a>
	</div>
	<div class="nav">
		<ul>
			<li>
				<dl>
					<dt><i class="ico ico-1"></i>地图管控</dt>
					<dd>
						<a href="track.html">车辆监控</a>
						<a href="dispatcherManage.html">调度管理</a>
						<a href="trackHis.html">历史轨迹</a>
						<a href="railManage.html">电子围栏</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-2"></i>视频监控</dt>
					<dd>
						<a href="ocxClient.html">多车视频监控</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-3"></i>信息报表</dt>
					<dd>
						<a href="alarmHotSpot.html">警情记录</a>
						<a href="alarmRecord.html">报警记录</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-4"></i>系统管理</dt>
					<dd>
						<a href="carManage.html">车辆管理</a>
						<a href="orgManage.html">机构管理</a>
						<a href="userManage.html">用户管理</a>
						<a href="roleManage.html">角色管理</a>
						<a href="purviewManage.html">权限管理</a>
						<a href="contactsManage.html">通讯录管理</a>
					</dd>
				</dl>
			</li>
		</ul>
	</div>
	<div class="user">
		<span>yitop</span>
		<i>|</i>
		<a href="javascript:;" id="mdyPwd">修改密码</a>
		<i>|</i>
		<a href="javascript:;" id="mdyTheme">主题</a>
		<i>|</i>
		<a href="login.html" class="ico ico-logout"></a>
	</div>
</div>
<!-- header end -->

<div class="wrapper">

	<div class="box">
		<div class="tit">权限管理</div>

		<div class="filter">
			<button type="button" class="ubtn ubtn-red" onclick="_add()">新增</button>
			<button type="button" class="ubtn ubtn-red" onclick="_edit()">编辑</button>
			<button type="button" class="ubtn ubtn-red" onclick="_del()">删除</button>
			<button type="button" class="ubtn ubtn-white" onclick="_expandAll()">全部展开</button>
			<button type="button" class="ubtn ubtn-white" onclick="_collapseAll()">全部合并</button>
		</div>

		<ul id="roleTree" class="ztree"></ul>

	</div>
</div>

<div class="footer">
    <span>湖北省宏锐慧通信息技术有限公司</span>
</div>

<!-- 新增&编辑 -->
<div class="form layer-form" id="tempForm">
	<div class="ftit">添加</div>
	<form name="form1" onsubmit="return false;">
		<div class="item req">
            <div class="txt">资源名称</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="resourceName" />
            </div>
        </div>
		<div class="item req">
            <div class="txt">请求地址</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="resourceString" />
            </div>
        </div>
		<div class="item req">
            <div class="txt">排序</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="priority" />
            </div>
        </div>
		<div class="item req">
            <div class="txt">资源类型</div>
            <div class="cnt">
            	<select name="resourceType" class="slt select2">
					<option value="url">菜单</option>
					<option value="button">按钮</option>
    			</select>
            </div>
        </div>
		<div class="item req">
            <div class="txt">是否启用</div>
            <div class="cnt">
            	<select name="resourceEnable" id="" class="slt select2">
                    <option value="0">启用</option>
                    <option value="1">禁用</option>
    			</select>
            </div>
        </div>
	    <div class="buttons">
	        <input name="supResourceId" type="hidden" />
	        <input name="resourceId" id="resourceId" type="hidden" />
	        <button type="button" class="ubtn ubtn-gray layer-close">取消</button>
	        <button type="submit" class="ubtn ubtn-red submit" onclick="_submitForm()">确定</button>
	    </div>
	</form>
</div>
<!-- end 新增&编辑 -->


<!-- 公用 -->
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/js/common.js"></script>

<!-- 页面专用 -->
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="assets/plugins/select2/select2.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>

<script>
var pageSetting = {
	name      : "权限", 	// 页面名称，用于提示信息
	submitURL : '', 	// 提交表单（新增&编辑url地址）
	getURL    : '', 	// 编辑信息时回填表单
	delURL    : '' 		// 删除一条数据
}

var setting = {
    check: {
        enable: true,
        chkboxType: { "Y": "", "N": "" }
    },
    data: {
        simpleData: {
            enable: true,
            idKey: "id",
            pIdKey: "pId",
            rootPId: null
        }
    },
    view: {
        showLine: true
    }
};

var treeData = [{"id":1,"pId":0,"name":"地图管控"},{"id":2,"pId":1,"name":"车辆监控"},{"id":3,"pId":1,"name":"调度管理"},{"id":4,"pId":1,"name":"历史轨迹"},{"id":5,"pId":1,"name":"电子围栏"},{"id":6,"pId":0,"name":"视频监控"},{"id":7,"pId":6,"name":"多车视频监控"},{"id":8,"pId":0,"name":"统计报表"},{"id":9,"pId":8,"name":"警情记录"},{"id":10,"pId":8,"name":"报警记录"},{"id":11,"pId":0,"name":"系统管理"},{"id":12,"pId":11,"name":"车辆管理"},{"id":13,"pId":11,"name":"机构管理"},{"id":14,"pId":11,"name":"用户管理"},{"id":15,"pId":11,"name":"角色管理"},{"id":16,"pId":11,"name":"权限管理"},{"id":17,"pId":0,"name":"修改密码"},{"id":18,"pId":0,"name":"注销"},{"id":19,"pId":0,"name":"主题"}];

var treeObj = $.fn.zTree.init($('#roleTree'), setting, treeData);
treeObj.expandAll(true);

// 全部展开
function _expandAll() {
	treeObj.expandAll(true);
}

// 全部折叠
function _collapseAll() {
    treeObj.expandAll(false);
}

function getSelectedNodes() {
	var selectedNodes = treeObj.getSelectedNodes();
	if (selectedNodes.length > 0) {
		return selectedNodes[0].id;
	}
	return '';
}

// 提交表单
function _submitForm() {
	var $temp = $('#tempForm');
	var $form = $temp.find('form');
	var pass = true;
	var tips = function() {
		$.notify({
			title: pageSetting.name + '信息没有填写完全',
			type: 'warning'
		})
		pass = false;
	}
	$form.find('.req input, .req select').each(function() {
		if (this.value == '') {
			tips();
			return false;
		}
	})
	$form.find('._cbx').each(function() {
		if ($(this).find('input:checked').length === 0 && pass) {
			tips();
			return false;
		}
	})
	if (pass) {
		var id = getSelectedNodes();
		// 提交表单
		var data = {}
        $('#resourceId').val(id);
		$.each($form.serializeArray(), function(i, item) {
			data[item.name] = item.value;
		})
		$.ajax({
			url: pageSetting.submitURL,
			data: data,
			success: function() {}
		})
	}
}

// 新增
function _add() {
	var $temp = $('#tempForm');
	var $form = $temp.find('form');
	$form[0].reset();
	$form.prev('.title').html('新增' + pageSetting.name);
	$form.find('.select2').trigger('change.select2');
	layer.open({
		fix: false,
		offset: '30px',
		area: '570px',
		type: 1,
		title: false,
		content: $temp
	})
}

// 编辑
function _edit() {
	var id = getSelectedNodes();
	if (id === '') {
		$.notify({'title': '请选择一个节点!', type: 'warning'});
	} else {
		var $temp = $('#tempForm');
		var $form = $temp.find('form');
		$form[0].reset();
		$form.prev('.title').html(pageSetting.name + '信息编辑');
		$.ajax({
			url: pageSetting.getURL,
			data: {id: id},
			success: function(res) {
				res = {data:{}}
				$form.find('.ipt, .slt').each(function(i, item) {
					this.value = res.data[this.name] || '';
				})
				$form.find('.select2').trigger('change.select2');
				layer.open({
					fix: false,
					offset: '30px',
					area: '570px',
					type: 1,
					title: false,
					content: $temp
				})
			}
		})
	}
}

// 删除一行
function _del(id) {
	var id = getSelectedNodes();
	if (id === '') {
		$.notify({'title': '请选择一个节点!', type: 'warning'});
	} else {
		layer.confirm('确定要删除该' + pageSetting.name + '么？', function(k) {
			$.ajax({
				url: pageSetting.delURL,
				data: {id: id},
				success: function(res) {
					if (res.result === "SUCCESS") {
						$.notify({
							title: "删除成功",
							type: "success"
						})
					}
				}
			})
			layer.close(k);
		})
	}
}

var _global = {
	init: function() {
		this.select2();
	},
	select2: function() {
		$('.select2').select2({
			minimumResultsForSearch: -1
		})
	}
}
</script>
</body>
</html>