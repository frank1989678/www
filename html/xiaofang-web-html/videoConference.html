<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>视频会议</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/zTreeStyle/jquery.ztree.css" />
    <link rel="stylesheet" href="assets/plugins/date/daterangepicker.min.css" />
    <script src="assets/js/jquery191.js"></script>
</head>
<body>
<!-- header begin -->
<div class="header cf">
    <div class="logo">
        <a href="index.html">武汉119作战指挥中心调度平台<em>Intelligent command platform for fire fighting</em></a>
    </div>
    <div class="nav">
        <ul>
            <li>
                <dl>
                <dt><i class="ico ico-1"></i>每日警情</dt>
                    <dd>
                        <a href="track.html">车辆监控</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-2"></i>历史统计</dt>
                    <dd>
                        <a href="alarmHotSpot.html">警情记录</a>
                        <a href="alarmRecord.html">报警记录</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-3"></i>车辆监控</dt>
                    <dd>
                        <a href="ocxClient.html">视频监控</a>
                        <a href="videoConference.html">视频会议</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-5"></i>地图管控</dt>
                    <dd>
                        <a href="track.html">车辆监控</a>
                        <a href="dispatcherManage.html">调度管理</a>
                        <a href="trackHis.html">历史轨迹</a>
                        <a href="railManage.html">电子围栏</a>
                    </dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt><i class="ico ico-6"></i>系统管理</dt>
                    <dd>
                        <a href="carManage.html">车辆管理</a>
                        <a href="orgManage.html">机构管理</a>
                        <a href="userManage.html">用户管理</a>
                        <a href="roleManage.html">角色管理</a>
                        <a href="purviewManage.html">权限管理</a>
                        <a href="contactsManage.html">通讯录管理</a>
                    </dd>
                </dl>
            </li>
            <li class="admin">
                指挥长 <em>欢迎登录</em>
            </li>
            <li class="dropdown">
                <dl class="menu">
                    <dt>设置</dt>
                    <dd>
                        <a href="javascript:;" id="mdyH1">配置标题</a>
                        <a href="javascript:;" id="mdyPwd">修改密码</a>
                        <a href="login.html">退出</a>
                    </dd>
                </dl>
            </li>
        </ul>
    </div>
</div>
<!-- header end -->

<div class="side" id="side">
    <div class="tit">
        <button type="button" onclick="getCarTree(0,0,0,0)" class="ico ico-refresh"></button>
        车辆列表
    </div>
    <div class="search">
        <form name="search">
            <label>车牌号</label>
            <input type="text" class="ipt" placeholder="请输入车牌号" onkeyup="searchCar(this)">
            <button type="button" class="ico ico-search"></button>
        </form>
        <div class="choose" id="autoSearch"></div>
    </div>
    <div class="tools">
        <button type="button" class="tooltip ico ico-1 active" onclick="getCarTree(0,0,0, 0)" data-tips="全部"></button>
        <button type="button" class="tooltip ico ico-2" onclick="getCarTree(2,0,0, 1)" data-tips="在线"></button>
        <button type="button" class="tooltip ico ico-4" onclick="getCarTree(0,2,0, 3)" data-tips="报警"></button>
        <button type="button" class="tooltip ico ico-5" onclick="getCarTree(0,0,1, 4)" data-tips="出警"></button>
    </div>
    <div class="open"></div>
    <ul id="carTree" class="ztree"></ul>
</div>

<script>
var treeTimer;
// 获取小车树形菜单
function getTree(data) {
    if (typeof window.setting === 'undefined') {
        return;
    }
    $.ajax({
        url: '/carMonitor/getTree',
        url: 'json/carTree.json',
        dataType: 'json',
        data: data,
        success: function(res) {
            var newObj = [];
            $.each(res, function(i, item) {
                item.open = true; // 展开节点
                if (item.iconSkin === 'car' && item.carType && item.carState) {
                    // 筛除离线车辆
                    if (item.carState == 2) {
                        return true; // continue
                    }
                    try {
                        item.icon = carIconObj[item.carType]['s' + item.carState];
                    } catch (err) {}
                }
                if (cars[item.id]) {
                    item.checked = true;
                }
                newObj.push(item);
            })
            $.fn.zTree.destroy('carTree');
            $.fn.zTree.init($('#carTree'), setting, newObj);
        },
        error: function() {
            $.notify({
                type: 'danger',
                title: '数据加载失败!'
            })
        }
    })
}

// 获取小车树形菜单
function getCarTree(carStatus, efStatus,actionStatus,idx) {
    // 导航高亮
    $('#side').find('.tools .ico').eq(idx).addClass('active').siblings().removeClass('active');
    getTree({
        carStatus: carStatus,
        efStatus: efStatus,
        actionStatus:actionStatus
    });
    autoRefreshCarTree(true);
}

/**
 * 自动刷新车辆类表
 * @param {Boolean} refresh 是否自动刷新
 */
function autoRefreshCarTree(refresh) {
    treeTimer && clearTimeout(treeTimer);
    if (refresh && 2 > 3) {
        treeTimer = setTimeout(function(){
            var str = $('#side').find('.tools .active').attr('onclick');
            eval(str)
        }, 30 * 1000);
    }
}

$(function() {
    getCarTree(0,0,0,0);

    // 鼠标在车辆列表上时关闭自动刷新
    $('#side').on('mouseenter', function() {
        autoRefreshCarTree();
    }).on('mouseleave', function() {
        autoRefreshCarTree(true);
    })
})

// 搜索车牌号
function searchCar(el) {
    var carNumber = el.value,
        zTree, treeNode, model = [];

    if (carNumber != '') {
        zTree = $.fn.zTree.getZTreeObj('carTree');
        treeNode = zTree.getNodesByParamFuzzy('name', carNumber);
        $.each(treeNode, function(i, item) {
            model.push('<span onclick="selectCar(' + item.id + ')">' + item.name + '</span>');
        })
    }
    $('#autoSearch').html(model.join('')).show();
}

// 搜索定位
function selectCar(carId) {
    var zTree = $.fn.zTree.getZTreeObj('carTree');
    var node = zTree.getNodeByParam('id', carId);
    zTree.cancelSelectedNode(false);
    zTree.selectNode(node, true);
}
</script>


<div class="wrapper fold">
    <div class="box">
        <div class="tit">参会车辆 <span class="count">（0/15）</span> <span class="voice">（0）</span></div>

        <div class="conference">
            <div class="list">
                <dl>
                    <dt><button type="button" class="ubtn ubtn-red import" onclick="add()">＋导入车辆</button></dt>
                </dl>

                <div class="cf tc">
                    <button type="button" class="ubtn ubtn-red fr" onclick="removeAllCar()">清空车辆</button>
                    <button type="button" class="ubtn ubtn-red fl" onclick="openMeet()">开启会议</button>
                    <button type="button" class="ubtn ubtn-primary" onclick="closeMeet()">关闭会议</button>
                </div>
            </div>

            <div class="cont">
                <div class="video">
                    <div class="scrn">
                        <div class="in"></div>
                        <div class="tit"></div>
                    </div>
                    <div class="scrn">
                        <div class="in"></div>
                        <div class="tit"></div>
                    </div>
                    <div class="scrn">
                        <div class="in"></div>
                        <div class="tit"></div>
                    </div>
                    <div class="scrn">
                        <div class="in"></div>
                        <div class="tit"></div>
                    </div>
                    <div class="full-screen">
                        <i class="ico ico-screen"></i>
                    </div>
                </div>
                <div class="cf tc">
                    <button type="button" class="ubtn ubtn-red" onclick="openCamera()">打开摄像头</button>
                    <button type="button" class="ubtn ubtn-primary" onclick="closeCamera()">关闭摄像头</button>
                    <button type="button" class="ubtn ubtn-red ubtn-voice">&nbsp;</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <span>湖北省宏锐慧通信息技术有限公司</span>
</div>

<input type="hidden" id="roomId" value="0">


<!-- 公用 -->
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/date/daterangepicker.min.js"></script>
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/common.js"></script>
<script src="assets/app/textcode.js"></script>
<script src="assets/js/video.js"></script>

</body>
</html>