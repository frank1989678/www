<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>在线人数</title>
    <meta name="renderer" content="webkit" />
    <style>
        body{margin:12px;}
        em{display:inline-block;vertical-align:middle;font-style:normal;font-size:14px;padding:5px 0;line-height:18px;background:none!important;}
        .col1{background:#111;width:44px;text-align:center;}
        .col2{background:#333;width:120px;}
        .col3{background:#555;width:100px;}
        .col4{background:#999;width:100px;}
        .col5{background:#ccc;width:160px;margin:0 15px;}
        .col6{background:#111;width:140px;}
        .col7{background:#eee;width:110px;text-align:center;}
        .table{width:830px;border:1px solid #78a7ff;font-size:0;}
        .tbody{max-height:240px;overflow:hidden;overflow-y:auto;}
        .tbody .col5:hover{color:#f00;cursor:default;}
        .thead{background:#78a7ff;padding:5px 0;color:#fff;}
        .tr{border-bottom:1px solid #ddd;}
        .striped{background:#eee;}
        .tooltipsy{position:absolute;left:0;color:#fff;background:#5a9bd5;border-radius:5px;padding:2px 6px;z-index:9;max-width:320px;line-height:24px;}
        .tooltipsy i{position:absolute;right:-5px;border:5px dashed transparent;border-left:5px solid #5a9bd5;border-right:0;width:0;height:0;overflow:hidden;}
        .tooltipsy b{display:inline-block;width:160px;font-size:12px;font-weight:400;vertical-align:top;}
    </style>
</head>

<body>

<div class="table">

<div class="thead">
    <em class="col1">序号</em>
    <em class="col2">用户名</em>
    <em class="col3">用户姓名</em>
    <em class="col4">角色</em>
    <em class="col5">相关区域</em>
    <em class="col6">登录时间</em>
    <em class="col7">登录IP</em>
</div>
<div class="tbody">
    <div class="tr">
        <em class="col1">1</em>
        <em class="col2">KFQDD</em>
        <em class="col3">开发区大队</em>
        <em class="col4">远程处警专席</em>
        <em class="col5" data-title="江岸区交通大队,江汉区交通大队">武汉经济技术开发区交通大队</em>
        <em class="col6">2017-09-18 22:45:41</em>
        <em class="col7">192.168.200.1</em>
    </div>
</div>

</div>
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script>
$(function() {
    var $tbody = $('.tbody');
    $.ajax({
        url: 'json/onlineUser.json',
        success: function(res) {
            var temp = [];
            var idx = 0;
            var fora = function(str) {
                return str.length > 11 ? (str.substring(0, 10) + '...') : str;
            }
            $.each(res.onlineUserMapDetail, function(i, item) {
                temp.push('<div class="tr' + (idx % 2 === 0 ? ' striped' : '') + '">');
                temp.push('<em class="col1">' + (++idx) + '</em>');
                temp.push('<em class="col2">' + item.acUserName + '</em>');
                temp.push('<em class="col3">' + item.acUserMonicker + '</em>');
                temp.push('<em class="col4">' + item.acUserTypeName + '</em>');
                temp.push('<em class="col5" data-title="' + item.userBrigadeNames + '">' + fora(item.userBrigadeNames) + '</em>');
                temp.push('<em class="col6">' + item.loginDate + '</em>');
                temp.push('<em class="col7">' + item.remoteAddr + '</em>');
                temp.push('</div>');
            })
            $tbody.html(temp.join(''));
        },
        error: function() {
            console.log(8)
        }
    })

    $tbody.on({
        mouseenter: function() {
            var 
                $el = $('<div class="tooltipsy"></div>'),
                msg = $(this).data('title') || '',
                offset = $(this).offset(),
                maxH = 290,
                w2 = 0,
                h2 = 0,
                _top = offset.top,
                arrow, arrowTop;

            if (msg.length === 0) {
                return;
            }
            $el.html('<b>' + msg.split(',').join('</b><b>') + '</b>').hide().appendTo($('body'));
            w2 = $el.outerWidth();
            h2 = $el.outerHeight();
            if (_top + h2 > maxH) {
                _top -= _top + h2 - maxH
            }
            arrowTop = offset.top - _top + 8;
            var arrow = '<i style="top:' + arrowTop + 'px;"></i>'
            $el.fadeIn().css({left: offset.left - w2 - 8, top: _top}).append(arrow);
        },
        mouseleave: function() {
            $('.tooltipsy').remove();
        }
    }, '.col5')
})

</script>
</body>
</html>