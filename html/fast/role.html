<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>角色管理</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/select2/select2.css" />
</head>
<body>

<!-- header begin -->
<div class="header cf">
	<div class="logo">
		<a href="index.html">交通事故快速处理平台</a>
	</div>
	<div class="user">
		<div class="online">在线用户数：8人</div>
		<dl>
			<dt><i class="ico ico-user"></i>系统管理员</dt>
			<dd>
				<a href="javascript:;" id="jmodifyPwd">修改密码</a>
				<a href="login.html">安全退出</a>
			</dd>
		</dl>
	</div>
</div>
<!-- header end -->

<div class="nav cf">
	<ul>
		<li><a href="index.html"><i class="ico ico-1"></i>首页</a></li>
		<li><a href="sgdz.html"><i class="ico ico-2"></i>事故定责</a></li>
		<li>
			<dl>
				<dt><i class="ico ico-3"></i>系统设置</dt>
				<dd>
					<a href="user.html">用户管理</a>
					<a href="role.html">角色管理</a>
					<a href="area.html">用户区域设置</a>
					<a href="source.html">资源管理</a>
				</dd>
			</dl>
		</li>
		<li>
			<dl>
				<dt><i class="ico ico-3"></i>报表统计</dt>
				<dd>
					<a href="statis.html">报表统计</a>
					<a href="accident-his.html">历史事故查询</a>
					<a href="accident.html">事故查询</a>
				</dd>
			</dl>
		</li>
	</ul>
</div>

<div class="wrapper">

	<div class="box">
		<div class="tit">角色列表</div>

		<div class="operate">
			<button type="button" class="ubtn ubtn-cyan" id="jadd">添加</button>
		</div>

		<div class="mt15 table">
			<script id="tableTemp" type="text/html">
				{{each list as item i}}
				<tr>
					<td>{{item.roleId}}</td>
					<td>{{item.roleName}}</td>
					<td>
						<button type="button" data-id="{{item.roleId}}" class="ubtn ubtn-orange jedit">授权</button>
					</td>
				</tr>
				{{/each}}
			</script>

			<table>
				<thead>
					<tr>
						<th>角色ID</th>
						<th>角色名</th>
						<th width="130">操作</th>
					</tr>
				</thead>
				<tbody id="tbody"></tbody>
			</table>
		</div>
		
		<div class="operate">
			<div class="pagination"></div>
		</div>
	</div>
</div>


<div class="form layer-form" id="tempForm">
	<div class="title">添加</div>
	<form name="form1" onsubmit="return false;">
		<div class="item">
            <div class="txt"><i>*</i>角色Id：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="roleId"  />
            </div>
        </div>
		<div class="item">
            <div class="txt"><i>*</i>角色名：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="roleName"  />
            </div>
        </div>
	    <div class="buttons" style="padding:20px 0;">
	        <button type="button" class="ubtn ubtn-cyan layer-close">取消</button>
	        <button type="submit" class="ubtn ubtn-blue submit">确定</button>
	    </div>
	</form>
</div>

<div class="form layer-form" id="treeForm">
	<div class="title">角色授权</div>
	<ul id="ztree" class="ztree"></ul>
    <div class="buttons" style="padding-top:20px;">
        <button type="button" class="ubtn ubtn-cyan layer-close">取消</button>
        <button type="button" class="ubtn ubtn-blue submit">确定</button>
    </div>
</div>


<!-- 公用 -->
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/js/common.js"></script>

<!-- 页面专用 -->
<link rel="stylesheet" href="assets/plugins/zTreeStyle/jquery.ztree.css" />
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/ajaxPage.js"></script>
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>

<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) -->
<script src="assets/js/mock.js"></script>
<script>
	Mock.mock('http://g.cn', {
		"result": "SUCCESS",
	    "totalSize": 2,
	    "list": [{
		    "roleId": "ROLE_USER",
	        "roleName": "用户角色"
		},{
		    "roleId": "ROLE_ADMIN",
	        "roleName": "管理员角色"
		},]
	});

	Mock.mock('http://h.cn', {
		"result": "SUCCESS",
	    "list": [{"id":null,"pId":null,"sid":"1","spid":"0","url":null,"name":"事故定责","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"4","spid":"1","url":null,"name":"待处理","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"5","spid":"1","url":null,"name":"处理中","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"6","spid":"1","url":null,"name":"定责完成","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"15","spid":"0","url":null,"name":"首页","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"3","spid":"0","url":null,"name":"报表统计","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"9","spid":"3","url":null,"name":"事故查询","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"10","spid":"3","url":null,"name":"历史事故查询","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"11","spid":"3","url":null,"name":"报表统计","checked":true,"nodes":null},{"id":null,"pId":null,"sid":"2","spid":"0","url":null,"name":"系统设置","checked":false,"nodes":null},{"id":null,"pId":null,"sid":"7","spid":"2","url":null,"name":"用户管理","checked":false,"nodes":null},{"id":null,"pId":null,"sid":"8","spid":"2","url":null,"name":"用户区域设置","checked":false,"nodes":null},{"id":null,"pId":null,"sid":"12","spid":"2","url":null,"name":"角色管理","checked":false,"nodes":null},{"id":null,"pId":null,"sid":"13","spid":"2","url":null,"name":"资源管理","checked":false,"nodes":null}]
	});
</script>
<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) end -->


<script>
var _global = {
	init: function() {
		this.filter();
		this.bindEvent();
	},
	filter: function() {
		var that = this;
		var page =  new Page({
			pageIndex: 1, // 当前页
			pageSize: 10, // 每页显示10条
			url: 'http://g.cn',
			callback: function(res) {
				$('#tbody').empty().html(template('tableTemp', res));
			}
		})
	},
	bindEvent: function() {
		var that = this,
			$temp = $('#tempForm'),
			$treeForm = $('#treeForm'),
			$form = $temp.find('form'),
			$tbody = $('#tbody'),
			opType = 'add';

		// 新增
		$('#jadd').on('click', function() {
			opType = 'add';
			$form[0].reset();
			$form.prev('.title').html('新增');
			layer.open({
				area: '540px',
				type: 1,
				title: false,
				content: $temp
			})
		})

        var setting = {
            check: {
                enable: true,
            	chkboxType: { 'Y': 'p', 'N': 's' }
            },
            data: {
	            simpleData: {
	                enable: true,
	                idKey: "sid",
	                pIdKey: "spid",
	                rootPId: 0
	            }
            },
            view: {
                showLine: false
            }
        };

		// 权限
		$tbody.on('click', '.jedit', function() {
			var roleId = $(this).data('id');
			$.ajax({
				url: 'http://h.cn',
				dataType: 'json',
				// data:{'rid': roleId},
				success: function(res) {
					$.fn.zTree.init($('#ztree'), setting, res.list);
					$.fn.zTree.getZTreeObj('ztree').expandAll(true);
					layer.open({
						area: '540px',
						offset: '50px',
						type: 1,
						title: false,
						content: $treeForm
					})
				},
				error: function() {
					$.notify({
						type: 'danger',
						title: '数据加载失败!'
					})
				}
			})
		})

		// 验证
		$form.validator({
            fields: {
                roleId: '角色Id: required',
                roleName: '角色名: required'
            },
            valid: function(form) {
            	// that.post($(form).serialize());
            	layer.closeAll();
				return false;
            }
        });
	}
}
</script>
</body>
</html>