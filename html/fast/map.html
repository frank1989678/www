<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>地图选点</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <style>
        .showMap{width:650px;height:500px;padding:10px;}
        .hd{line-height:30px;}
        .ipt{width:510px;}
        #mapCon{width:650px;height:450px;margin-top:10px;}
    </style>
</head>

<body>

<div class="showMap">
    <div class="hd">
        请输入:
        <input type="text" id="suggestId" value="" class="ipt" />
        <button type="button" class="ubtn ubtn-cyan" id="searchMap">搜索</button>
    </div>
    <div class="bd" id="mapCon"></div>
</div>



<script src="http://api.map.baidu.com/api?v=2.0&ak=cmlN6SWFTGXTwUe4GUAAWWpb"></script>
<script src="assets/js/jquery191.js"></script>
<script>
function getQueryString(name) { 
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null; 
} 
var searchPot = getQueryString('region');
var map = new BMap.Map("mapCon",{minZoom:5,maxZoom:20});    // 创建Map实例
var count = 10;
var local;
map.centerAndZoom(new BMap.Point(114.26223945913, 30.59443142983), 15);  // 初始化地图,设置中心点坐标和地图级别
map.setCurrentCity("武汉");
map.enableScrollWheelZoom(true);
map.addControl(new BMap.MapTypeControl());   //添加地图类型控件

map.addEventListener("click", function(e){
    var geoc = new BMap.Geocoder();
    var pt = e.point;
    geoc.getLocation(pt, function(rs){
        var addComp = rs.addressComponents;
        var address = addComp.province + addComp.city  + addComp.district  + addComp.street + addComp.streetNumber;
        window.parent.mapCallback(pt, address);
    });
});
local = new BMap.LocalSearch(map, {
    renderOptions:{map: map}
});
$("#searchMap").click(function(){
    local.search($("#suggestId").val());
});
$("#suggestId").on('keyup', function(e) {
    if (e.keyCode == 13) {
        local.search(this.value);
    }
})
searchPot && $("#suggestId").val(searchPot) && local.search(searchPot);
</script>
</body>
</html>