<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>武汉车辆管理平台</title>
    <meta name="renderer" content="webkit" />
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/datetimepicker/style.css" />
    <link rel="stylesheet" href="assets/plugins/select2/select2.css" />
</head>
<body>

<!-- header begin -->
<div class="header">
	<div class="logo">
		<a href="index.html">随手拍管理系统</a>
	</div>
	<div class="user">
		<span>yitop</span>
		<i>|</i>
		<a href="modify_password.html">修改密码</a>
		<i>|</i>
		<a href="about.html">关于</a>
		<i>|</i>
		<a href="contact.html">联系</a>
		<i>|</i>
		<a href="login.html" class="ico ico-logout"></a>
	</div>
</div>
<!-- header end -->

<div class="nav box">
	<dl>
		<dt>
			<i class="ico ico-1"></i>
			<span>举报审核</span>
			<i class="arrow"></i>
		</dt>
		<dd>
			<a href="wfsh.html">违法审核</a>
			<a href="wtsh.html">违停审核</a>
			<a href="shqr.html">审核确认</a>
		</dd>
	</dl>
	<dl>
		<dt>
			<i class="ico ico-2"></i>
			<span>审核统计</span>
			<i class="arrow"></i>
		</dt>
		<dd>
			<a href="ExamineCountAndExportManagerView.html">按地区统计</a>
			<a href="StatisticsByUserView.html">按审核人员统计</a>
			<a href="JiangjinfafangAndExportManagerView.html">奖金发放统计</a>
			<a href="WatchOfferRecordManagerView.html">举报信息查询</a>
		</dd>
	</dl>
	<dl>
		<dt>
			<i class="ico ico-3"></i>
			<span>系统管理</span>
			<i class="arrow"></i>
		</dt>
		<dd>
			<a href="UserManageView.html">账号管理</a>
			<a href="RoleManagerView.html">角色管理</a>
			<a href="ModifyValidateView.html">安全管理</a>
			<a href="DictionaryMangerView.html">字典管理</a>
			<a href="LawTypeManagerView.html">违法类型管理</a>
			<a href="PurviewManageView.html">资源管理</a>
			<a href="DLLDManageView.html">道路路段管理</a>
		</dd>
	</dl>
</div>

<div class="wrapper box">
	<div class="breadcrumb"><i class="ico ico-site"></i>资源管理</div>

	<div class="filter">
		<form id="filterForm" action="#!">

				<label class="for">资源权限编号</label>
				<input type="text" class="ipt" name="number" id="number" />
				<label class="for">资源权限名称</label>
				<input type="text" class="ipt" name="name" id="name" />
				<label class="for">父资源权限</label>
				<input type="text" class="ipt" name="uplevel" id="uplevel" />

				<label class="for">权限类型</label>
				<select name="type" id="type" class="slt select2">
					<option value="">全部</option>
					<option value="0">菜单资源</option>
					<option value="1">功能资源</option>
					<option value="2">字段权限</option>
				</select>

				<button type="submit" class="ubtn ubtn-primary">查询</button>
				<button type="button" class="ubtn ubtn-primary" id="jadd">新增</button>
		</form>
	</div>
	
	<div class="table">
		<script id="tableTemp" type="text/html">
			{{each list as item i}}
			<tr>
				<td><label class="cbx"><input type="checkbox" value="{{item.id}}" /></label></td>
				<td>{{item.number}}</td>
				<td>{{item.name}}</td>
				<td>{{item.path}}</td>
				<td>{{item.sort}}</td>
				<td>{{item.uplevel}}</td>
				<td>{{item.type}}</td>
				<td>
					<button type="button" class="ubtn ubtn-ghost jedit" data-id="{{item.id}}">编辑</button>
					<button type="button" class="ubtn ubtn-red jdel" data-id="{{item.id}}">删除</button>
				</td>
			</tr>
			{{/each}}
		</script>

		<table class="tc">
			<thead>
				<tr>
					<th width="50"><label class="cbx"><input type="checkbox" /></label></th>
					<th>资源权限编号</th>
					<th>资源权限名称</th>
					<th>资源路径</th>
					<th>排序</th>
					<th>父资源权限</th>
					<th>权限类型</th>
					<th width="180">操作</th>
				</tr>
			</thead>
			<tbody id="tbody">
				<tr>
					<td><label class="cbx"><input value="1" type="checkbox"></label></td>
					<td>117</td>
					<td>拍摄范围</td>
					<td>UserPlace:SetupUserScopeManageView</td>
					<td>11</td>
					<td>账号管理</td>
					<td>功能资源</td>
					<td>
						<button type="button" class="ubtn ubtn-ghost jedit" data-id="1">编辑</button>
						<button type="button" class="ubtn ubtn-red jdel" data-id="1">删除</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<div class="operate">
		<div class="action">
			<button type="button" class="ubtn ubtn-red jdel">批量删除</button>
			<select name="" class="slt select2">
				<option value="10">每页10行</option>
				<option value="20">每页20行</option>
				<option value="50">每页50行</option>
				<option value="100">每页100行</option>
			</select>
		</div>
		<div class="pagination"></div>
	</div>
</div>


<div class="form layer-form" id="tempForm">
	<div class="title">新增</div>
	<form action="">
		<div class="item">
            <div class="txt">资源权限名称：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="name" />
            </div>
        </div>
		<div class="item">
            <div class="txt">资源路径：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="path" />
            </div>
        </div>
		<div class="item">
            <div class="txt">父资源权限：</div>
            <div class="cnt">
				<select name="uplevel" class="slt select2">
					<option value="0">审核页面</option>
					<option value="1">奖金发放统计</option>
					<option value="2">资源管理</option>
					<option value="3">举报检测</option>
					<option value="4">事件审核</option>
				</select>
            </div>
        </div>
		<div class="item">
            <div class="txt">权限类型：</div>
            <div class="cnt">
				<select name="type" class="slt select2">
					<option value="0">菜单资源</option>
					<option value="1">功能资源</option>
					<option value="2">字段权限</option>
				</select>
            </div>
        </div>
		<div class="item">
            <div class="txt">排序：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="sort" />
            </div>
        </div>

	    <div class="buttons" style="padding:20px 0;">
	        <button type="button" class="ubtn ubtn-blue layer-close">关闭</button>
	        <button type="submit" class="ubtn ubtn-blue submit" style="width:120px;">保存信息</button>
	    </div>
	</form>
</div>

<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/datetimepicker/core.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/select2/select2.js"></script>
<script src="assets/js/common.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/jquery.pagination.min.js"></script>

<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) -->
<script src="assets/js/mock.js"></script>
<script>
	Mock.setup({
	    timeout: '300-1000' // 表示响应时间介于 200 和 600 毫秒之间，默认值是'10-100'。
	})
	Mock.mock('http://g.cn', {
		"result": "SUCCESS",
		"currentPage": 1,
	    "nextPage": 2,
	    "pageSize": 5,
	    "totalPage": 27,
	    "totalSize": 131,
	    "list|10": [{
		    "id": "@increment",
		    "number|1-100": 1,
		    "name": "拍摄范围",
		    "path": "UserPlace:SetupUserScopeManageView",
		    "sort|1-10": 1,
		    "uplevel": "账号管理",
		    "type|1": ["菜单资源","功能资源","字段权限"]
		}]
	});

	Mock.mock('http://h.cn', {
		"result": "SUCCESS",
	    "data": {
		    "number|1-100": 1,
		    "name": "拍摄范围",
		    "path": "UserPlace:SetupUserScopeManageView",
		    "sort|0-10": 1,
		    "uplevel|0-4": 1,
		    "type|0-2": 1
		}
	});

	Mock.mock('http://del.cn', {
		"result": "SUCCESS",
	    "data": {
	    	"result|0-1": 1
		}
	});

</script>
<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) end -->


<script>
	!(function($) {
		var _global = {
			init: function() {
				this.select2();
				this.filterData = {}; // 搜索条件
				this.filter();
				this.request(this.filterData, true); // 加载数据并初始化分页
				this.bindEvent();
			},
			select2: function() {
				$('.slt').select2();
			},
			filter: function() {
				var that = this;
				var $form = $('#filterForm');

				// 每页显示
			    $('.action').find('.slt').on('change', function() {
			    	that.filterData.pageSize = this.value;
			    	that.request(that.filterData, true);
			    })

				// 查询
				$form.on('submit', function() {
					that.filterData.number = $('#number').val();
					that.filterData.name   = $('#name').val();
					that.filterData.uplevel   = $('#uplevel').val();
					that.filterData.type   = $('#type').val();
					that.request(that.filterData, true);
					return false;
				})
			},
			/**
			 * 添加删除classname
			 * @param  {Object} data ajax参数
			 * @param  {Boolean} initPage  是否初始化分页
			 */
			request: function(data, initPage) {
				var that = this;
				fx.request('http://g.cn', data, function(res){
					var model = template('tableTemp', res);
					$("#tbody").empty().html(model);
					window.scrollTo(0, 0);
					initPage && that.paginate(res.pageSize, res.totalSize);
				});
			},
			paginate: function(pageSize, totalSize) {
				var that = this;
				function pageselectCallback(page_index) {
					that.filterData.page_index = page_index;
					that.request(that.filterData);
					showDetail(page_index);
				}
				// 分页统计
				function showDetail(page_index) {
					$('.pagination').prepend('<div class="p-size">第' + (page_index + 1) + '页/共' + Math.ceil(totalSize/pageSize) + '页（共' + totalSize + '行）</div>');
				}
				$('.pagination').pagination(totalSize, {
                    num_edge_entries: 2,
                    callback: pageselectCallback,
                    items_per_page: pageSize // 每页显示数量
                });
                showDetail(0);
			},
			bindEvent: function() {
				var that = this,
					$temp = $('#tempForm'),
					$form = $temp.find('form'),
					$tbody = $('#tbody');

				// 新增
				$('#jadd').on('click', function() {
					$form[0].reset();
					$form.find('.select2').trigger('change.select2');
					layer.open({
						area: '540px',
						type: 1,
						title: false,
						content: $temp
					})
				})

				// 编辑
				$tbody.on('click', '.jedit', function() {
					opType = 'edit';
					var id = $(this).data('id');
					$form[0].reset();
					$form.prev('.title').html('编辑');
					if (id) {
						fx.request('http://h.cn', {id: id}, function(res){
							$form.find('.ipt[name="name"]').val(res.data.name);
							$form.find('.ipt[name="path"]').val(res.data.path);
							$form.find('.ipt[name="sort"]').val(res.data.sort);
							$form.find('.slt[name="uplevel"]').val(res.data.uplevel);
							$form.find('.slt[name="type"]').val(res.data.type);
							$form.find('.select2').trigger('change.select2');
							layer.open({
								area: '540px',
								type: 1,
								title: false,
								content: $temp
							})
						});
					}
				})

				// 验证
				$form.validator({
                    fields: {
                        name: 'required',
                        path: 'required',
                        sort: 'required'
                    },
                    valid: function(form) {
                    	// that.post($(form).serialize());
                    	layer.closeAll();
						return false;
                    }
                });

				// 关闭弹层
				$temp.on('click', '.layer-close', function() {
					layer.closeAll();
				})
                // 删除
                $tbody.on('click', '.ubtn-red', function() {
                	var id = $(this).data('id');
                	layer.confirm('确认删除吗？', function(key) {
                		layer.close(key);
                		that.del({id: id});
                	})
                })

                // 批量删除
			    $('.action').find('.jdel').on('click', function() {
			    	var ids = [];
			    	$tbody.find('.cbx input:checked').each(function() {
			    		ids.push(this.value);
			    	})
			    	if (ids.length === 0) {
			    		$.notify({
			    			type: 'warning',
			    			content: '请至少选择一行'
			    		})
			    	} else {
			    		that.del({ids: ids.join(',')});
			    	}
			    })

			},
			del: function(data) {
				fx.loading();
        		$.ajax({
        			url: 'http://del.cn',
        			dataType: 'json',
        			type: 'GET',
        			type: 'POST',
        			data: data,
        			success: function(res) {
        				fx.closeLoading();
        				if (res.data.result == 0) {
        					$.notify({
        						type: 'danger',
        						title: '删除失败'
        					})
            			} else {
        					$.notify({
        						type: 'success',
        						title: '删除成功'
        					})
            			}
        			}
        		})
			}
		}

		_global.init();
	})(jQuery);
</script>
</body>
</html>