<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>地图选点</title>
    <meta name="renderer" content="webkit" />
    <style>
        html,body{width:100%;height:100%;margin:0;padding:0;}
        .showMap{width:100%;height:100%;position:relative;}
        .hd{font-size:14px;line-height:32px;padding:5px;position:absolute;top:5px;left:5px;background:#fff;z-index:4;}
        .ipt{width:400px;height:24px;line-height:24px;padding:3px 7px;border:1px solid #ddd;font-size:14px;background-color:#fff;vertical-align:top;}
        .ubtn{display:inline-block;width:80px;line-height:30px;padding:0 8px;text-align:center;cursor:pointer;border:0;color:#fff;background:#dd4635;vertical-align:top;}
        .ubtn:hover{background-color:#c63f30;}
        #mapCon{width:100%;height:100%;}
    </style>
</head>

<body>

<div class="showMap">
    <div class="hd">
        请输入：
        <input type="text" id="suggestId" value="" class="ipt" />
        <button type="button" class="ubtn" id="searchMap">搜索</button>
    </div>
    <div class="bd" id="mapCon"></div>
</div>



<script src="http://api.map.baidu.com/api?v=2.0&ak=cmlN6SWFTGXTwUe4GUAAWWpb"></script>
<script src="../assets/js/jquery191.js"></script>
<script>
function getQueryString(name) { 
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null; 
} 
var searchPot = getQueryString('region');
var map = new BMap.Map("mapCon",{minZoom:5,maxZoom:20});    // 创建Map实例
var count = 10;
var local;
map.centerAndZoom(new BMap.Point(114.26223945913, 30.59443142983), 15);  // 初始化地图,设置中心点坐标和地图级别
map.setCurrentCity("武汉");
map.enableScrollWheelZoom(true);
map.addControl(new BMap.MapTypeControl());   //添加地图类型控件

map.addEventListener("click", function(e){
    var geoc = new BMap.Geocoder();
    var pt = e.point;
    geoc.getLocation(pt, function(rs){
        var addComp = rs.addressComponents;
        var address = addComp.province + addComp.city  + addComp.district  + addComp.street + addComp.streetNumber;
        window.parent.mapCallback(pt, address);
    });
});
local = new BMap.LocalSearch(map, {
    renderOptions:{map: map}
});
$("#searchMap").click(function(){
    local.search($("#suggestId").val());
});
$("#suggestId").on('keyup', function(e) {
    if (e.keyCode == 13) {
        local.search(this.value);
    }
})
searchPot && $("#suggestId").val(searchPot) && local.search(searchPot);

// 百度地图搜索
var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
    {"input" : "suggestId"
    ,"location" : map
});

ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
    var _value = e.item.value;
    var myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
    map.clearOverlays();    //清除地图上所有覆盖物
    local.search(myValue);
});

</script>
</body>
</html>