<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>车辆监控</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>

<!-- header begin -->
<div class="header cf">
	<div class="logo">
		<a href="index.html">武汉119作战指挥中心调度平台</a>
	</div>
	<div class="nav">
		<ul>
			<li>
				<dl>
					<dt><i class="ico ico-1"></i>地图管控</dt>
					<dd>
						<a href="track.html">车辆监控</a>
						<a href="dispatcherManage.html">调度管理</a>
						<a href="trackHis.html">历史轨迹</a>
						<a href="railManage.html">电子围栏</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-2"></i>视频监控</dt>
					<dd>
						<a href="ocxClient.html">多车视频监控</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-3"></i>信息报表</dt>
					<dd>
						<a href="alarmHotSpot.html">警情记录</a>
						<a href="alarmRecord.html">报警记录</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-4"></i>系统管理</dt>
					<dd>
						<a href="carManage.html">车辆管理</a>
						<a href="orgManage.html">机构管理</a>
						<a href="userManage.html">用户管理</a>
						<a href="roleManage.html">角色管理</a>
						<a href="purviewManage.html">权限管理</a>
						<a href="contactsManage.html">通讯录管理</a>
					</dd>
				</dl>
			</li>
		</ul>
	</div>
	<div class="user">
		<span>yitop</span>
		<i>|</i>
		<a href="javascript:;" id="mdyPwd">修改密码</a>
		<i>|</i>
		<a href="javascript:;" id="mdyTheme">主题</a>
		<i>|</i>
		<a href="login.html" class="ico ico-logout"></a>
	</div>
</div>
<!-- header end -->

<div class="map" id="map"></div>

<div class="side" id="side">
	<div class="tit"><button type="button" class="ico ico-refresh"></button>车辆列表</div>
	<div class="search">
		<form action="javascript:return false;" name="search" method="GET">
			<label>车牌号</label>
			<input type="text" class="ipt" placeholder="请输入车牌号">
			<button type="submit" class="ico ico-search"></button>
		</form>
	</div>
	<div class="tools">
		<button type="button" class="tooltip ico ico-1 active" data-tips="全部"></button>
		<button type="button" class="tooltip ico ico-2" data-tips="在线"></button>
		<button type="button" class="tooltip ico ico-3" data-tips="离线"></button>
		<button type="button" class="tooltip ico ico-4" data-tips="报警"></button>
		<button type="button" class="tooltip ico ico-5" data-tips="刷新"></button>
	</div>
	<div class="open"></div>
	<ul id="carTree" class="ztree"></ul>
</div>

<div class="side" id="side4">
	<button type="button" class="tooltip ico ico-1" data-tips="路况" id="traffic"></button>
	<button type="button" class="tooltip ico ico-2" data-tips="机构" id="org"></button>
	<button type="button" class="tooltip ico ico-3" data-tips="警情" id="avc"></button>
	<button type="button" class="tooltip ico ico-4" data-tips="消防栓" id="xfx"></button>
</div>

<div class="side" id="side5">
	<div class="tit">实时报警 </div>
	<ul></ul>
	<div class="open"></div>
</div>

<div class="side" id="side6">
	<div class="tit"><button type="button" class="ico ico-add" onclick="_addAlarm();"></button>警情列表</div>
	<div class="tab">
		<span class="active">待处理（<i class="t1">0</i>）</span>
		<span>处理中（<i class="t2">0</i>）</span>
	</div>
	<div class="cont">
		<div class="item">
			<ul class="ul1"></ul>
		</div>
		<div class="item hide">
			<ul class="ul2"></ul>
		</div>
	</div>
	<div class="open"></div>
</div>

<div class="footer-fix">
    <span>湖北省宏锐慧通信息技术有限公司</span>
</div>

<!-- 公用 -->
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/js/common.js"></script>

<!-- 左侧菜单 -->
<script src="json/carTree.js"></script>
<!-- 页面专用 -->
<link rel="stylesheet" href="assets/plugins/jedate/jedate.css" />
<script src="assets/plugins/jedate/jquery.jedate.min.js"></script>
<link rel="stylesheet" href="assets/plugins/zTreeStyle/jquery.ztree.css" />
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="http://webapi.amap.com/maps?v=1.3&key=9d870244cd940650899a73c0566d7652&plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.Geocoder"></script>
<script src="assets/js/gaode.tools.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/track.js"></script>

<!-- 点击小车详情模板 -->
<script id="carTemp" type="text/html">
<div class="layer-detail">
    <ul class="ul1">
        <li>车辆所属机构：{{org}}</li>
        <li>终端SIM：{{SIM}}</li>
        <li>使用人姓名：{{username}}</li>
        <li>使用人电话：{{mobile}}</li>
        <li>车辆用途：{{use}}</li>
        <li>车辆在线状态：{{online}}</li>
        <li>车辆出警状态：{{status}}</li>
    </ul>
    <ul class="ul2">
        <li>电子围栏状态：{{cross}}</li>
        <li>SOS状态：{{SOS}}</li>
        <li>GPS上报时间：{{date}}</li>
        <li>GPS速度：{{speed}}</li>
        <li>GPS地址：{{gps}}</li>
        <li>车辆当日里程：{{km}}</li>
    </ul>
    {{if online == '在线'}}
    <div class="btm">
        <a href="trackHis.html?id={{id}}" class="ubtn ubtn-red">历史轨迹</a>
        <a href="dispatcherManage.html?id={{id}}" class="ubtn ubtn-red">调度管理</a>
        <a href="ocxClient.html?id={{id}}" class="ubtn ubtn-red">视频监控</a>
        <button type="button" class="ubtn ubtn-red">一键抓拍</button>
    </div>
    {{/if}}
    {{if status == '出动'}} 
    <div class="dynamic">
		<div class="hd">出警动态<i class="fold"></i></div>
		<div class="bd">
		    <ul class="ul1">
		        <li>立案时间：{{time}}</li>
		        <li>燃烧对象：{{obj}}</li>
		        <li>案发地点：{{address}}</li>
		        <li>距离现场距离：{{distance}}</li>
		    </ul>
		    <ul class="ul2">
		        <li>类别：{{type}}</li>
		        <li>级别：{{level}}</li>
		        <li>车辆出警状态：{{status}}</li>
		        <li>预计到场时间：{{minute}}</li>
		    </ul>
	    </div>
    </div>
    {{/if}}
</div>
</script>
<!-- end 点击小车详情模板 -->

<!-- 警情详情模板 -->
<script id="detailTemp" type="text/html">
	<div class="detail">
    <ul>
        <li>警情立案时间：{{data.createTime}}</li>
        <li>警情燃烧对象：{{data.obj}}</li>
        <li>警情案发地点：{{data.address}}</li>
        <li>报警人姓名：{{data.username}}</li>
        <li>报警人电话：{{data.mobile}}</li>
        <li>报警内容：{{data.content}}</li>
    </ul>
    <ul>
        <li>警情GPS经度：{{data.lng}}</li>
        <li>警情GPS纬度：{{data.lat}}</li>
        <li>警情处置机构：{{data.org}}</li>
        <li>警情类别：{{data.type}}</li>
        <li>警情级别：{{data.level}}</li>
        <li>警情状态：{{data.status}}</li>
    </ul>
    <div class="btm">
        <button type="button" class="ubtn ubtn-red fl">暂缓处理</button>
        <button type="button" class="ubtn ubtn-red fr">忽略</button>
    </div>

    <div class="table">
        <table>
            <thead>
                <tr>
                    <th>警情调派时间</th>
                    <th>调派车辆</th>
                    <th>接警车辆</th>
                    <th>接警时间</th>
                    <th>车辆到场时间</th>
                </tr>
            </thead>
            <tbody>
            	{{each carList as item i}}
                <tr>
                    <td>{{item.beginTIme}}</td>
                    <td>{{item.car}}</td>
                    <td>{{item.carNumber}}</td>
                    <td>{{item.startTime}}</td>
                    <td>{{item.endTime}}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="form">
        <form action="javascript:return false;" method="POST" name="anqin">
            <div class="item">
                <label>案发地位置修正：</label>
                <input type="text" class="ipt" style="width:244px;" readonly="" />
                <div class="map" id="map"></div>
                <button type="button" class="ubtn ubtn-red">保存</button>
            </div>

            <div class="item">
                <label>车辆到场的地点：</label>
                <input type="text" class="ipt" id="address" placeholder="请输入地址" />
            </div>

            <div class="item">
                <label>到场地点的经度：</label>
                <input type="text" class="ipt" id="lng" style="width:110px;" />
                <label style="margin-left:60px;">到场地点的纬度：</label>
                <input type="text" class="ipt" id="lat" style="width:110px;" />
                <button type="button" class="ubtn ubtn-gray">选择</button>
            </div>
            <div class="item">
                <label>选择需要调派的车辆：</label>
                <select name="" class="slt select2" style="width:372px;">
                    <option value="">鄂A10001</option>
                    <option value="">鄂A10002</option>
                </select>
                <button type="button" class="ubtn ubtn-red">调派</button>
            </div>
        </form>
    </div>
</div>
</script>
<!-- end 警情详情模板 -->

<script>
var cars = {};
var icons = {
	green: 'assets/images/icon/water/green.png',
	red: 'assets/images/icon/water/red.png',
	blue: 'assets/images/icon/water/blue.png',
	gray: 'assets/images/icon/water/gray.png',
	level2: 'assets/images/icon/ico-level2.png',
	level3: 'assets/images/icon/ico-level3.png',
	level4: 'assets/images/icon/ico-level4.png',
	xfx: 'assets/images/icon/ico-xfx.png',
	water: 'assets/images/icon/ico-water.png'
}
var marker = {
	org: [{
			name: '江岸大队',
			lng: '114.293085',
			lat: '30.597529',
			icon: icons.level2 // 大队
		}, {
			name: '青年路中队',
			lng: '114.326387',
			lat: '30.585744',
			icon: icons.level3 // 中队
		}, {
			name: '天地小型站',
			lng: '114.311968',
			lat: '30.556554',
			icon: icons.level4 // 小队
		}
	],
	xfx: [{
			name: '江岸大队',
			lng: '114.293085',
			lat: '30.697529',
			icon: icons.xfx // 消防栓
		}, {
			name: '青年路中队',
			lng: '114.326387',
			lat: '30.685744',
			icon: icons.water // 水滴
		}, {
			name: '天地小型站',
			lng: '114.311968',
			lat: '30.656554',
			icon: icons.xfx // 消防栓
		}
	]
}

// 选择小车
function chooseCar(event, treeId, treeNode) {
	var id = treeNode.id;
	if (!cars[id]) {
		getCar(id);
	}
}
// 勾选小车
function checkCar(event, treeId, treeNode) {
	var id = treeNode.id;
	if (treeNode.checked) {
		if (!cars[id]) {
			getCar(id);
		}
	} else {
		cars[id].destory(); // 删除车
		id && delete cars[id];
	}
}

// 获取小车
function getCar(id) {
	$.ajax({
		url: '',
		data: {id, id},
		success: function(res) {
			res = {
				name: '鄂A10001',
				lnt: '116.387646',
				lag: '39.979127',
				icon: icons.green // 在线
			}
			drawCar(id, res);
			map.setFitView();
		}
	})
}
// 添加小车到地图
function drawCar(id, data) {
	cars[id] = new Car({
		key: id,
        position: [data.lnt, data.lag],
        icon: data.icon,
        offset: new AMap.Pixel(-20, -15),
        autoRotation: true,
        crossFn: function(isCross, overlay, car) {
            if (isCross) {
                car.setIcon(icons.gray);
            } else {
                car.setIcon(icons.red);
            }
        },
        change: function(car) {
            car.setIcon(icon.red);
        },
        clickFn: function() {
        	showCarDetail();	
        }
    })
}

// 点击小车
function showCarDetail(id) {
	$.ajax({
		url: '',
		data: {id, id},
		success: function(res) {
			res = {
				'id': '1',
				'name': '鄂A10001',
				'org': '硚口大队',
				'SIM': '15000000',
				'username': '陈一鸥',
				'mobile': '15000000',
				'use': '消防',
				'online': '在线',
				'status': '出动',
				'cross': '报警',
				'SOS': '正常',
				'date': '2017-09-11 09:22:11',
				'speed': '34',
				'gps': '武汉市武昌区积玉桥街办事处中山路338号',
				'km': '39.98km',
				'time': '2017-09-10',
				'obj': '房屋',
				'address': '武汉市光谷大道金融港',
				'distance': '1000m',
				'type': '火警',
				'level': '二级',
				'minute': '10分钟'
			}
			layer.closeAll('dialog');
			layer.open({
				shift: -1,
				shade: false,
				btn: false,
        		area: '530px',
				title: res.name,
				content: template('carTemp', res)
			})
			$('.dynamic').on('click', '.fold', function() {
				$('.dynamic').toggleClass('show');
			})
		}
	})
}


var setting = {
    check: {
        enable: true,
        chkboxType: { "Y": "", "N": "" }
    },
    data: {
        simpleData: {
            enable: true,
            idKey: "id",
            pIdKey: "pId",
            rootPId: null
        }
    },
    view: {
        showLine: true
    },
	callback: {
		onClick: chooseCar,
		onCheck: checkCar
	}
};

// treeData在 json/carTree.js
var treeObj = $.fn.zTree.init($('#carTree'), setting, treeData);
treeObj.expandAll(true);

var map = new AMap.Map('map');


</script>
</body>
</html>