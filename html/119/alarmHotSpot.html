<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>警情记录</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/select2/select2.css" />
</head>
<body>

<!-- header begin -->
<div class="header cf">
	<div class="logo">
		<a href="index.html">武汉119作战指挥中心调度平台</a>
	</div>
	<div class="nav">
		<ul>
			<li>
				<dl>
					<dt><i class="ico ico-1"></i>地图管控</dt>
					<dd>
						<a href="track.html">车辆监控</a>
						<a href="dispatcherManage.html">调度管理</a>
						<a href="trackHis.html">历史轨迹</a>
						<a href="railManage.html">电子围栏</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-2"></i>视频监控</dt>
					<dd>
						<a href="ocxClient.html">多车视频监控</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-3"></i>信息报表</dt>
					<dd>
						<a href="alarmHotSpot.html">警情记录</a>
						<a href="alarmRecord.html">报警记录</a>
					</dd>
				</dl>
			</li>
			<li>
				<dl>
					<dt><i class="ico ico-4"></i>系统管理</dt>
					<dd>
						<a href="carManage.html">车辆管理</a>
						<a href="orgManage.html">机构管理</a>
						<a href="userManage.html">用户管理</a>
						<a href="roleManage.html">角色管理</a>
						<a href="purviewManage.html">权限管理</a>
						<a href="contactsManage.html">通讯录管理</a>
					</dd>
				</dl>
			</li>
		</ul>
	</div>
	<div class="user">
		<span>yitop</span>
		<i>|</i>
		<a href="javascript:;" id="mdyPwd">修改密码</a>
		<i>|</i>
		<a href="javascript:;" id="mdyTheme">主题</a>
		<i>|</i>
		<a href="login.html" class="ico ico-logout"></a>
	</div>
</div>
<!-- header end -->

<div class="wrapper">

	<div class="box">
		<div class="tit">警情记录</div>

		<div class="filter">
			<form name="filterForm" id="filter" action="javascript:return false;" method="GET">
				<label class="for">查询时间：</label>
				<input type="text" name="queryStartTime" id="queryStartTime" class="ipt" />
				<em>至</em>
				<input type="text" name="queryEndTime" id="queryEndTime" class="ipt" />
				<label class="for">接警车辆：</label>
				<input type="text" name="carNumber" class="ipt" />
				<label class="for">警情类别：</label>
				<select name="type" class="slt select2">
					<option value="">火警</option>
					<option value="">社会救援</option>
				</select>
				<label class="for">警情级别：</label>
				<select name="level" class="slt select2">
					<option value="">一级警情</option>
					<option value="">二级警情</option>
				</select>

				<button type="submit" class="ubtn ubtn-red">查询</button>
			</form>
		</div>

		<div class="table">
			<table>
				<thead>
					<tr>
						<th>警情立案时间</th>
						<th>警情级别</th>
						<th>警情类别</th>
						<th>警情燃烧对象</th>
						<th>警情地点（修正后的）</th>
						<th>报警人姓名</th>
						<th>报警人电话</th>
						<th>报警内容</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="tbody"></tbody>
			</table>
		</div>
		
		<div class="operate">
			<div class="pagination"></div>
		</div>
	</div>
</div>

<div class="footer">
    <span>湖北省宏锐慧通信息技术有限公司</span>
</div>

<!-- 公用 -->
<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/js/common.js"></script>

<!-- 页面专用 -->
<script src="assets/plugins/select2/select2.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/ajaxPage.js"></script>
<link rel="stylesheet" href="assets/plugins/jedate/jedate.css" />
<script src="assets/plugins/jedate/jquery.jedate.min.js"></script>
<script src="http://webapi.amap.com/maps?v=1.3&key=9d870244cd940650899a73c0566d7652&plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.Geocoder"></script>
<script id="tableTemp" type="text/html">
	{{each list as item i}}
	<tr>
		<td>{{item.datetime}}</td>
		<td>{{item.level}}</td>
		<td>{{item.type}}</td>
		<td>{{item.object}}</td>
		<td>{{item.region}}</td>
		<td>{{item.realname}}</td>
		<td>{{item.mobile}}</td>
		<td>{{item.content}}</td>
		<td>
			<button type="button" class="ubtn ubtn-primary" onclick="_showDetail('{{item.id}}')">详情</button>
		</td>
	</tr>
	{{/each}}
</script>

<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) -->
<script src="assets/js/mock.js"></script>
<script>
	Mock.mock('http://g.cn', {
		"result": "SUCCESS",
	    "totalSize": 18,
	    "list|10": [{
		    "id": "@increment",
	        "datetime": "20170901 08:21",
	        "level": "二级",
	        "type": "火警",
	        "object": "居民住宅",
	        "region": "武汉市书城路",
	        "realname": "@cname",
	        "mobile": /^1[345678]\d{9}$/,
	        "content": "出门忘记带家里钥匙了",
	        "team": "洪山大队",
	        "time": "20170901 08:21",
	        "carNumber": "鄂A10001",
	        "car": "鄂A10001",
	        "beginTime": "20170901 08:21",
	        "bendTime": "20170901 08:31"
		}]
	});
</script>
<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) end -->


<script>
var iconMarker;
var map2;
// 详情
function _showDetail(iid) {
	$.ajax({
		url: 'alarmHotSpotDetail2.html',
		type: 'GET',
		dataType: 'html',
		data: {iid: iid},
		cache: false,	
		success: function(res) {
			layer.open({
				type: 1,
				shift: -1,
				move: false,
				fix: false,
				btn: false,
				offset: '90px',
		        title: '警情详情',
		        area: '640px',
		        content: res,
		        cancel: function() {
		        	map2 = null;
		        	iconMarker = null;
		        }
			})
			map2 = new AMap.Map('map2');
		}
    })
}

// 地图选点回调
function _mapCallback(pt, address) {
	var msg = '确定保存该地点经纬度？ <br/>';
    msg += '地点位置：' + address + '<br/>';
    msg += '地点坐标：经度：' + pt.lng + ',纬度：' + pt.lat + '<br/>';

    layer.confirm(msg, function(idx) {
    	$('#tipinput2').val(address);
        $('#lng').val(pt.lng);
        $('#lat').val(pt.lat);
        $('#slng').html(pt.lng);
        $('#slat').html(pt.lat);
        if ($('#address').val() == '') {
            $('#address').val(address);
        }

        layer.close(idx);
        layer.close(mapID);
        try {
            iconMarker && iconMarker.setMap(null);
	        iconMarker = new AMap.Marker({
	            map: map2,
	            position: [pt.lng, pt.lat],
	            icon: new AMap.Icon({            
	                size: new AMap.Size(23, 28), 
	                image: 'assets/images/icon/marker.png'
	            })        
	        });
	        map2.setFitView();
        }catch(err) {}

    });
}
// 显示地图
var mapID = 0;
function _showMap() {
	mapID = layer.open({
		type: 1,
		area: ['1000px', '600px'],
		content: '<div class="show-map"><div class="hd">请输入关键字：<input type="text" id="tipinput2" class="ipt"/></div><div class="bd" id="amap"></div></div>'
	})
	
	map2 = new AMap.Map('amap');
	var autoOptions = {
	    input: "tipinput2"
	};
	var auto = new AMap.Autocomplete(autoOptions);
	var placeSearch = new AMap.PlaceSearch({
	    map: map2
	});  //构造地点查询类
	AMap.event.addListener(auto, "select", _autoSelect);//注册监听，当选中某条记录时会触发
	AMap.event.addListener(placeSearch, 'markerClick', _markerClick);//注册监听，当点击某个点时会触发
	function _autoSelect(e) {
	    if (e.poi && e.poi.location) {
	        map2.setZoom(15);
	        map2.setCenter(e.poi.location);
	        $('#lng').val(e.poi.location.lng);
	        $('#lat').val(e.poi.location.lat);
	        $('#slng').html(e.poi.location.lng);
	        $('#slat').html(e.poi.location.lat);
	        if ($('#address').val() == '') {
	            $('#address').val(address);
	        }
	    }
	    placeSearch.setCity(e.poi.adcode);
	    placeSearch.search(e.poi.name);  //关键字查询查询
	}

	function _markerClick(e) {
		if (e.data && e.data.location) {
	        map.setZoom(15);
	        map.setCenter(e.data.location);
	        var pt = {
		        lng: e.data.location.lng,
		        lat: e.data.location.lat
		    }
		    var address = e.data.name;
	        _mapCallback(pt, address);
		}
	}

	map2.on('click', function(e) {
	    var address = '';
	    var pt = {
	        lng: e.lnglat.getLng(),
	        lat: e.lnglat.getLat()
	    }
	    var geocoder = new AMap.Geocoder({
	        radius: 1000,
	        extensions: "all"
	    });
	    var lnglatXY = new AMap.LngLat(pt.lng, pt.lat); 
	    geocoder.getAddress(lnglatXY, function(status, result) {
	        if (status === 'complete' && result.info === 'OK') {
	            address = result.regeocode.formattedAddress;
	        }
	        try{
	            _mapCallback(pt, address);
	        }catch(err){}
	    });
	});

	$("#tipinput2").on('keyup', function(e) {
	    if (e.keyCode == 13) {
	        placeSearch.search(this.value);  //关键字查询查询
	    }
	})
}


var _global = {
	init: function() {
		this.jeDate();
		this.check();
		this.filter();
		this.select2();
	},
	jeDate: function() {
		$.mydate({
            start: '#queryStartTime',
            end: '#queryEndTime',
            format: 'YYYY-MM-DD'
        })
	},
	select2: function() {
		$('.select2').select2({
			minimumResultsForSearch: -1
		})
	},
	check: function() {
		var $tbody = $('#tbody');
		// 复选框
		$tbody.on('click', '.cbx', function() {
			var disable = $(this).hasClass('cbx-on');
			$(this).toggleClass('cbx-on');
			$(this).closest('tr').find('.ubtn').prop('disabled', disable);
		})
	},
	filter: function() {
		var that = this;
		var $form = $('#filter');
		var page =  new Page({
			request: false,
			pageIndex: 1, // 当前页
			pageSize: 10, // 每页显示10条
			url: 'http://g.cn',
			callback: function(res) {
				$('#tbody').empty().html(template('tableTemp', res));
			}
		})
		
		// 查询
		$form.on('submit', function() {
			var filterData = $form.serializeArray();
			page.request(true, filterData);
			return false;
		})


	}
}
</script>
</body>
</html>