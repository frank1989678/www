<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>送货时间</title>
    <link rel="stylesheet" href="">
</head>

<body>
    <form id="form1">
        <input type="hidden" name="_fma.pu._0.sta" value="" />
        <input type="hidden" name="_fma.pu._0.auc" value="-2" />
        <input type="radio" class="radio" name="_now" value="0" id="_now0" onclick="setTimeEnableAndInStock(false, false)" />
        <label for="_now0">立刻</label>
        <input type="radio" class="radio" name="_now" value="1" id="_now1" onclick="setTimeEnableAndInStock(true, false)" />
        <label for="_now1">设定</label>
        <select name="_date" onchange="changeDate()"></select>
        <select name="_hour" onchange="changeHour()"></select>时
        <select name="_minute" onchange="setMinute()"></select>分
        <span class="prop-tips" id="durainfo">您可以设定宝贝的正式开始销售时间</span>
        <input type="radio" class="radio" name="_now" value="2" id="inStock" onclick="setTimeEnableAndInStock(false, true)" />
        <label for="inStock">放入仓库</label>
    </form>
    <script type="text/javascript">
    var item_form = document.forms['form1'];
    var _hourObject = item_form.elements['_hour'];
    var _dateObject = item_form.elements['_date'];
    var _minuteObject = item_form.elements['_minute'];
    var serverTime = "";
    var clientTime = new Date();
    var offset = 0;
    if (serverTime != '') {
        offset = serverTime - clientTime.getTime();
    }
    var maxDate = 14;
    try {
        var now = new Date();
        now.setTime(now.getTime() + offset);
        var date = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var dateTime = item_form.elements["_fma.pu._0.sta"].value;
        dateTime = dateTime.replace('-0', '-');
        var dateTimeArray = dateTime.split(' ');
        if (dateTimeArray[0]) {
            date = dateTimeArray[0];
        }
        if (dateTimeArray[1]) {
            var timeArray = dateTimeArray[1].split(':');
            if (timeArray[0]) {
                hour = timeArray[0];
            }
            if (timeArray[1]) {
                minute = timeArray[1];
            }
        }
        //format date
        date = date.replace('-0', '-');
        //delete old options
        for (var i = _dateObject.length - 1; i >= 0; --i) {
            _dateObject.remove(i);
        }
        //add new options
        var selected = 0;
        for (var i = 0; i <= maxDate; ++i) {
            var _now = new Date();
            _now.setTime(_now.getTime() + offset);
            _now.setDate(now.getDate() + i);
            var displayDate = _now.getFullYear() + '年' + (_now.getMonth() + 1) + '月' + _now.getDate() + '日';
            var dateValue = _now.getFullYear() + '-' + (_now.getMonth() + 1) + '-' + _now.getDate();
            _dateObject.options[i] = new Option(displayDate, dateValue);
            if (date == dateValue) {
                selected = i;
            }
        }
        if (_dateObject.options[selected]) {
            _dateObject.options[selected].selected = 'selected';
        }
        changeDate();
        //item_form.elements['_now'][0].checked = true;
        item_form.elements['_fma.pu._0.auc'].value = "0";
        item_form.elements['_date'].disabled = true;
        item_form.elements['_hour'].disabled = true;
        item_form.elements['_minute'].disabled = true;
    } catch (e) {
        //alert(e.message + e.number);
    }

    function setStartTimeEnable(flag) {
        _dateObject.disabled = !flag;
        _hourObject.disabled = !flag;
        _minuteObject.disabled = !flag;
    }

    function changeDate() {
        try {
            //delete old hour
            for (var i = _hourObject.length - 1; i >= 0; --i) {
                _hourObject.remove(i);
            }
            var startDate = new Date();
            startDate.setTime(startDate.getTime() + offset);
            var endDate = new Date();
            endDate.setTime(endDate.getTime() + offset);
            endDate.setDate(endDate.getDate() + maxDate);
            var currDate = new Date();
            currDate.setTime(currDate.getTime() + offset);
            var currDateStr = _dateObject.options[_dateObject.selectedIndex].value;
            var dateArray = currDateStr.split('-');
            currDate.setFullYear(dateArray[0], dateArray[1] - 1, dateArray[2]);
            currDate.setSeconds(0);
            var startHour = 0;
            var endHour = 24;
            var key = 0;
            var selected = 0;
            for (var i = startHour; i < endHour; ++i) {
                currDate.setHours(i);
                currDate.setMinutes(59);
                if (startDate.getTime() > currDate.getTime()) {
                    continue;
                }
                currDate.setMinutes(0);
                if (currDate.getTime() > endDate.getTime()) {
                    break;
                }
                _hourObject.options[key] = new Option(i, i);
                if (hour == i) {
                    selected = key;
                }
                key++;
            }
            if (_hourObject.options[selected]) {
                _hourObject.options[selected].selected = 'selected';
            }
            changeHour();
        } catch (e) {
            //alert(e.message + e.number);
        }
    }

    function setTimeEnableAndInStock(bTime, bInStock) {
        setStartTimeEnable(bTime);
        if (bInStock && bInStock == true) {
            if ("true" == "true") {
                document.forms['form1'].elements['_fma.pu._0.auc'].value = "-2";
            } else {
                document.forms['form1'].elements['_fma.pu._0.auc'].value = "-5";
            }
        } else {
            document.forms['form1'].elements['_fma.pu._0.auc'].value = "0";
        }
    }

    function setStartTimeEnable(flag) {

        _dateObject.disabled = !flag;
        _hourObject.disabled = !flag;
        _minuteObject.disabled = !flag;
    }

    function changeDate() {
        try {
            //delete old hour
            for (var i = _hourObject.length - 1; i >= 0; --i) {
                _hourObject.remove(i);
            }
            var startDate = new Date();
            startDate.setTime(startDate.getTime() + offset);
            var endDate = new Date();
            endDate.setTime(endDate.getTime() + offset);
            endDate.setDate(endDate.getDate() + maxDate);
            var currDate = new Date();
            currDate.setTime(currDate.getTime() + offset);
            var currDateStr = _dateObject.options[_dateObject.selectedIndex].value;
            var dateArray = currDateStr.split('-');
            currDate.setFullYear(dateArray[0], dateArray[1] - 1, dateArray[2]);
            currDate.setSeconds(0);

            var startHour = 0;
            var endHour = 24;
            var key = 0;
            var selected = 0;
            for (var i = startHour; i < endHour; ++i) {
                currDate.setHours(i);
                currDate.setMinutes(59);
                if (startDate.getTime() > currDate.getTime()) {
                    continue;
                }
                currDate.setMinutes(0);
                if (currDate.getTime() > endDate.getTime()) {
                    break;
                }
                _hourObject.options[key] = new Option(i, i);
                if (hour == i) {
                    selected = key;
                }
                key++;
            }
            if (_hourObject.options[selected]) {
                _hourObject.options[selected].selected = 'selected';
            }
            changeHour();
        } catch (e) {
            //alert(e.message + e.number);
        }
    }

    function changeHour() {
        try {
            //delete old minute
            for (var i = _minuteObject.length - 1; i >= 0; --i) {
                _minuteObject.remove(i);
            }

            var startDate = new Date();
            startDate.setTime(startDate.getTime() + offset);
            var endDate = new Date();
            endDate.setTime(endDate.getTime() + offset);
            endDate.setDate(endDate.getDate() + maxDate);
            var currDate = new Date();
            currDate.setTime(currDate.getTime() + offset);
            var currDateStr = _dateObject.options[_dateObject.selectedIndex].value;
            var dateArray = currDateStr.split('-');
            currDate.setFullYear(dateArray[0], dateArray[1] - 1, dateArray[2]);
            currDate.setHours(_hourObject.options[_hourObject.selectedIndex].value);
            currDate.setSeconds(0);
            hour = currDate.getHours();

            var startMinute = 0;
            var endMinute = 60;
            var step = 5;
            var key = 0;
            var selected = 0;
            for (var i = startMinute; i < endMinute; i += 5) {
                currDate.setMinutes(i);
                if (startDate.getTime() > currDate.getTime()) {
                    continue;
                }
                if (currDate.getTime() > endDate.getTime()) {
                    break;
                }
                _minuteObject.options[key] = new Option(i, i);
                if (Math.abs(minute - i) < step) {
                    selected = key;
                }
                key++;
            }
            if (_minuteObject.options[selected]) {
                _minuteObject.options[selected].selected = 'selected';
            }
        } catch (e) {
            //alert(e.message + e.number);
        }
    }

    function setMinute() {
        minute = _minuteObject.value;
    }

    function setTimeEnableAndInStock(bTime, bInStock) {
        setStartTimeEnable(bTime);
        if (bInStock && bInStock == true) {
            if ("true" == "true") {
                document.forms['form1'].elements['_fma.pu._0.auc'].value = "-2";
            } else {
                document.forms['form1'].elements['_fma.pu._0.auc'].value = "-5";
            }
        } else {
            document.forms['form1'].elements['_fma.pu._0.auc'].value = "0";
        }
    }
    </script>
</body>

</html>
